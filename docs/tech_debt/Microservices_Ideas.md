# üöÄ Microservices Architecture: Ideas & Patterns

> **Status:** Brainstorming
> **Goal:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏ –¥–ª—è –±—É–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –°–µ—Ä–≤–∏—Å—ã

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –º–æ–Ω–æ–ª–∏—Ç–∞ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º, –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –¥–æ–º–µ–Ω—ã:

*   **Front-Bot Service:**
    *   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü—Ä–∏–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–±—ç–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (UI-–ª–æ–≥–∏–∫–∞).
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** `aiogram`.
    *   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:** –û–±—â–∞–µ—Ç—Å—è —Å `Game-Core` —á–µ—Ä–µ–∑ API (REST/gRPC).

*   **Game-Core Service:**
    *   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í—Å—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–±–æ–π, –∫—Ä–∞—Ñ—Ç, —Å–∫–∏–ª–ª—ã, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∏—Ñ—Ç–æ–≤). –ù–µ –∑–Ω–∞–µ—Ç –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ Telegram.
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** `FastAPI` –∏–ª–∏ `gRPC` —Å–µ—Ä–≤–µ—Ä.
    *   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç `Front-Bot`, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î –∏ Redis.

*   **Worker Service(s):**
    *   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –§–æ–Ω–æ–≤—ã–µ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏.
    *   **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** `Celery`.
    *   **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á:**
        *   –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Redis –≤ Postgres.
        *   –†–∞—Å—Å—ã–ª–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
        *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Å–ø–∞–≤–Ω –±–æ—Å—Å–æ–≤, –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–∏—Ñ—Ç–æ–≤).

---

## 2. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –†–µ—à–µ–Ω–∏—è

### 2.1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –°–æ—Å—Ç–æ—è–Ω–∏—è –ò–≥—Ä–æ–∫–∞ (Redis -> Postgres)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –∏ –¥—Ä—É–≥–∏–µ "–≥–æ—Ä—è—á–∏–µ" –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ —ç—Ç–æ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ (Ticker / Snapshot):**
1.  **–°–æ–∑–¥–∞–µ—Ç—Å—è Celery Beat –∑–∞–¥–∞—á–∞**, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5).
2.  **–ó–∞–¥–∞—á–∞ (`snapshot_task`):**
    *   –°–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –∫–ª—é—á–∏ `account:*` –≤ Redis.
    *   –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (`location_id`, `hp_current` –∏ —Ç.–¥.) –≤ –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫.
    *   –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ–¥–∏–Ω –º–∞—Å—Å–æ–≤—ã–π `UPDATE` –∑–∞–ø—Ä–æ—Å –∫ Postgres (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `UPDATE ... FROM VALUES`).
3.  **–ü–ª—é—Å—ã:**
    *   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Ä–∞–∑ –≤ N –º–∏–Ω—É—Ç).
    *   –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
4.  **–ú–∏–Ω—É—Å—ã:**
    *   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –≤ "–æ–∫–Ω–µ" –º–µ–∂–¥—É —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏ (–¥–ª—è RPG —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ).

### 2.2. –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

*   **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (–ó–∞–ø—Ä–æ—Å-–û—Ç–≤–µ—Ç):**
    *   **REST API (FastAPI):** –ü—Ä–æ—â–µ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏. `Front-Bot` –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∫ `Game-Core`.
    *   **gRPC:** –ë–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. –¢—Ä–µ–±—É–µ—Ç `proto`-—Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ (–°–æ–±—ã—Ç–∏—è):**
    *   **RabbitMQ / Redis Pub/Sub:** –î–ª—è —Å–æ–±—ã—Ç–∏–π, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏—Ö –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
    *   *–ü—Ä–∏–º–µ—Ä:* `Game-Core` –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `rift_collapsed`, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è `Front-Bot` –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞–º.

---
