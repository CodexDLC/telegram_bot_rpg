# üß™ Testing Standard (–°—Ç–∞–Ω–¥–∞—Ä—Ç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Standards](./README.md)

---

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è
–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏. –ú—ã –Ω–µ –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø: **"Fail Fast, Fix Fast"**.

## üìä –ü–∏—Ä–∞–º–∏–¥–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Unit Tests (70%)
*   **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (—Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã).
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ù–ò–ö–ê–ö–ò–• –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ (–ë–î, Redis, HTTP). –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–∫–∞—é—Ç—Å—è.
*   **–°–∫–æ—Ä–æ—Å—Ç—å:** < 10ms –Ω–∞ —Ç–µ—Å—Ç.
*   **–ì–¥–µ:** `tests/unit/` –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞ –∏–ª–∏ —Ñ–∏—á–∏.

### 2. Integration Tests (20%)
*   **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Service + Repository, Client + Orchestrator).
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î (Docker) –∏–ª–∏ –º–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö API.
*   **–ì–¥–µ:** `tests/integration/` –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞.

### 3. E2E / Flow Tests (10%)
*   **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (Register -> Login -> Play).
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω—ã –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
*   **–ì–¥–µ:** `tests/e2e/` (–≥–ª–æ–±–∞–ª—å–Ω–æ).

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

*   **Runner:** `pytest`
*   **Async:** `pytest-asyncio` (mode = auto)
*   **Mocks:** `unittest.mock`, `pytest-mock`
*   **Fixtures:** `conftest.py` (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

---

## üèõÔ∏è Backend Testing

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
–¢–µ—Å—Ç—ã –∂–∏–≤—É—Ç –≤–Ω—É—Ç—Ä–∏ –¥–æ–º–µ–Ω–∞:
```plaintext
backend/domains/user_features/{domain}/tests/
‚îú‚îÄ‚îÄ unit/               # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤, –¥–≤–∏–∂–∫–æ–≤
‚îú‚îÄ‚îÄ integration/        # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –≥–µ–π—Ç–≤–µ–µ–≤
‚îî‚îÄ‚îÄ conftest.py         # –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
1.  **Services:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞. –ú–æ–∫–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
2.  **Repositories:** SQL –∑–∞–ø—Ä–æ—Å—ã. –ò—Å–ø–æ–ª—å–∑—É–µ–º `test_db` (Rollback –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞).
3.  **Gateways:** –ú–∞–ø–ø–∏–Ω–≥ DTO.

---

## üì± Client Testing (Telegram Bot)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
–¢–µ—Å—Ç—ã –∂–∏–≤—É—Ç –≤–Ω—É—Ç—Ä–∏ —Ñ–∏—á–∏:
```plaintext
game_client/telegram_bot/features/{feature}/tests/
‚îú‚îÄ‚îÄ unit/               # –¢–µ—Å—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, UI
‚îî‚îÄ‚îÄ conftest.py
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º
1.  **Orchestrators:**
    *   –ú–æ–∫–∞–µ–º `ApiClient` (–ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã API).
    *   –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–µ–π—Ç–æ–≤ (FSM).
2.  **UI Components:**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ `render()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏.
    *   –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞, —á–∏—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ DTO -> View.
3.  **Handlers:**
    *   –û–±—ã—á–Ω–æ –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏ (—Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å —Å Aiogram). –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ E2E –∏–ª–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

---

## üìù Naming Convention

*   –§–∞–π–ª: `test_{component}.py`
*   –ö–ª–∞—Å—Å: `Test{Component}`
*   –ú–µ—Ç–æ–¥: `test_{method}_{scenario}_{expected_result}`
    *   *–ü—Ä–∏–º–µ—Ä:* `test_calculate_damage_crit_returns_double`

---

## üö´ Anti-Patterns (–ß–µ–≥–æ –¥–µ–ª–∞—Ç—å –ù–ï–õ–¨–ó–Ø)
1.  **Sleep:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `time.sleep()` –≤ —Ç–µ—Å—Ç–∞—Ö (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –∏–ª–∏ await).
2.  **Global State:** –ó–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
3.  **Real API:** –•–æ–¥–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã–π Telegram API –∏–ª–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î.
