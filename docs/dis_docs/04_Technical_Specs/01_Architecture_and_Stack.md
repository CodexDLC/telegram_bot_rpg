# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –°—Ç–µ–∫

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ü–∞—Ç—Ç–µ—Ä–Ω: 3-Tier Modular Monolith

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–π —Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏.

### üîª Layer 1: Handlers (Controller)
* **–ì–¥–µ:** `app/handlers/`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü—Ä–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Telegram, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –≤—ã–∑–æ–≤ UI-—Å–µ—Ä–≤–∏—Å–æ–≤.
* **–ü—Ä–∞–≤–∏–ª–æ:** –ù–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. –¢–æ–ª—å–∫–æ `await ui_service.render_...()`.

### üîª Layer 2: UI Services (Presenter / Facade)
* **–ì–¥–µ:** `app/services/ui_service/`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (HTML, Keyboards). –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ –∫ Game Services.
* **–ü—Ä–∏–º–µ—Ä:** `InventoryUIService`, `CombatUIService`.

### üîª Layer 3: Game Services (Domain Logic)
* **–ì–¥–µ:** `app/services/game_service/`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞—Å—á–µ—Ç—ã, —Ä–∞–±–æ—Ç–∞ —Å –ë–î/Redis —á–µ—Ä–µ–∑ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
* **–ü—Ä–∞–≤–∏–ª–æ:** –í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ DTO –∏–ª–∏ –ø—Ä–∏–º–∏—Ç–∏–≤—ã. –ù–µ –∑–Ω–∞—é—Ç –ø—Ä–æ Telegram API.
* **–ü—Ä–∏–º–µ—Ä:** `InventoryService`, `CombatService`, `AbilityService`.

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

### Core
* **Python:** 3.11+
* **Framework:** `aiogram 3.x` (Long-polling / Webhook ready).
* **DI Container:** –†—É—á–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Middleware (`AppContainer`).

### Data & State
* **SQLAlchemy (Async):**
    * *Dev:* SQLite (`aiosqlite`) + WAL mode.
    * *Prod:* PostgreSQL.
* **Redis:**
    * –•—Ä–∞–Ω–µ–Ω–∏–µ FSM (Machine State).
    * –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö" –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—è).
    * –û—á–µ—Ä–µ–¥–∏ (Matchmaking).
* **Pydantic:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ DTO (`*_dto.py`).

### AI Integration
* **Google GenAI SDK:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è Gemini 1.5.
* **Prompt Engineering:** –ü—Ä–µ—Å–µ—Ç—ã –∏ JSON-—Å—Ö–µ–º—ã –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –ò–ò.