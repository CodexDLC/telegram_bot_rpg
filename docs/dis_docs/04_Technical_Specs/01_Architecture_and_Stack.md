# –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –°–¢–ï–ö

## 1. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫ (Technology Stack)

### Core
*   **Python:** 3.11+
*   **Framework:** `aiogram 3.x` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram Bot API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫).
*   **DI Container:** –†—É—á–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Middleware (`AppContainer`).

### Data & State
*   **SQLAlchemy (Async):**
    *   *Dev:* SQLite (`aiosqlite`) —Å —Ä–µ–∂–∏–º–æ–º WAL –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
    *   *Prod:* PostgreSQL –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.
*   **Redis:**
    *   –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM (Finite State Machine).
    *   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö" –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—è).
    *   –û—á–µ—Ä–µ–¥–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥).
*   **Pydantic:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è DTO (Data Transfer Objects).

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ü–∞—Ç—Ç–µ—Ä–Ω: Orchestrator Pattern

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä–æ–≥—É—é 5-—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ UI –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

### –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤ (Data Flow)
`Handler` -> `Bot Orchestrator` -> `Core Client` -> `Core Orchestrator` -> `Domain Service`

1.  **Handler (UI Controller)**:
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `CallbackQuery`.
    *   –î–æ—Å—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ FSM.
    *   –í—ã–∑—ã–≤–∞–µ—Ç `Bot Orchestrator`.
    *   –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ DTO.

2.  **Bot Orchestrator (UI Logic)**:
    *   –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–∫–∞–∫–æ–µ –º–µ–Ω—é –ø–æ–∫–∞–∑–∞—Ç—å).
    *   –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Core –≤ UI-—Ñ–æ—Ä–º–∞—Ç (DTO).
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UIService` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.

3.  **Core Client (Gateway/Adapter)**:
    *   –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –Ø–¥—Ä–æ–º.
    *   –ò–∑–æ–ª–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ (–ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ gRPC/HTTP).

4.  **Core Orchestrator (Business Facade)**:
    *   –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –º–æ–¥—É–ª—è.
    *   –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –∫ —Ä–∞–∑–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º (–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å + –ö–æ—à–µ–ª–µ–∫ + –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞).

5.  **Domain Service (Business Logic)**:
    *   –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã.
    *   –†–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î –∏ Redis.

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ (Project Layout)

### `apps/` ‚Äî –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

#### üìÅ `apps/common/`
**–û–±—â–∏–π –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ.**
*   `core/`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞, DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (`AppContainer`).
*   `database/`: –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –±–∞–∑–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –º–æ–¥–µ–ª–∏ ORM.
*   `schemas_dto/`: –û–±—â–∏–µ DTO.

#### üìÅ `apps/game_core/`
**–Ø–¥—Ä–æ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏. –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Telegram.**
*   `game_service/`: –û—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (`CombatService`, `InventoryService`).
*   `resources/`: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∏–≥—Ä—ã –¥–∞–Ω–Ω—ã–µ.

#### üìÅ `apps/bot/`
**–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ —Å–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram.**
*   `handlers/`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram-—Å–æ–±—ã—Ç–∏–π.
*   `ui_service/`: –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ UI –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—ã –±–æ—Ç–∞.
*   `core_client/`: –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —è–¥—Ä—É.
*   `middlewares/`: Middleware –¥–ª—è `aiogram`.
*   `main.py`: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞.

#### üìÅ `docs/`
**–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.**
*   `dis_docs/`: –î–∏–∑–∞–π–Ω-–¥–æ–∫—É–º–µ–Ω—Ç—ã (–õ–û–†, –º–µ—Ö–∞–Ω–∏–∫–∏, —Ç–µ—Ö. —Å–ø–µ–∫–∏).

---

## 4. –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ("–ó–æ–ª–æ—Ç–æ–π –°—Ç–∞–Ω–¥–∞—Ä—Ç")

*   **DTO Only:** –ú–µ–∂–¥—É —Å–ª–æ—è–º–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (Pydantic), –Ω–∏–∫–∞–∫–∏—Ö –∫–æ—Ä—Ç–µ–∂–µ–π –∏–ª–∏ —Å—ã—Ä—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π.
*   **Thin Handlers:** –•–µ–Ω–¥–ª–µ—Ä—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.
*   **Dual-Message System:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Å–µ–≥–¥–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ö–æ–Ω—Ç–µ–Ω—Ç –∏ –ú–µ–Ω—é).
*   **Lazy Activation:** –¢—è–∂–µ–ª—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä –±–æ—è) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
