# –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –°–¢–ï–ö

## 1. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫ (Technology Stack)

### Core
*   **Python:** 3.11+
*   **Framework:** `aiogram 3.x` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram Bot API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫).
*   **DI Container:** –†—É—á–Ω–∞—è –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Middleware.

### Data & State
*   **SQLAlchemy (Async):**
    *   *Dev:* SQLite (`aiosqlite`) —Å —Ä–µ–∂–∏–º–æ–º WAL –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
    *   *Prod:* PostgreSQL –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.
*   **Redis:**
    *   –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM (Finite State Machine).
    *   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö" –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—è).
    *   –û—á–µ—Ä–µ–¥–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥).
*   **Pydantic:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è DTO (Data Transfer Objects).

### AI Integration
*   **Google GenAI SDK:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è **Gemini 2.0 Flash** (–∏–ª–∏ –Ω–æ–≤–µ–µ).
*   **Prompt Engineering:** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ—Å–µ—Ç–æ–≤ –∏ JSON-—Å—Ö–µ–º –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ü–∞—Ç—Ç–µ—Ä–Ω: –ú–æ–¥—É–ª—å–Ω—ã–π –ú–æ–Ω–æ–ª–∏—Ç (Monorepo)

–ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ (Alpha) –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ **–ú–æ–¥—É–ª—å–Ω—ã–π –ú–æ–Ω–æ–ª–∏—Ç** –≤ –µ–¥–∏–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ–∑ –æ–≤–µ—Ä—Ö–µ–¥–∞ –Ω–∞ —Å–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.

### Future Architecture (MVP Transition)
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ MVP –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è):
1.  **Game Core Container:** –í—Å—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (`apps/game_core`) –±—É–¥–µ—Ç –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –¥–æ—Å—Ç—É–ø–Ω—ã–π —á–µ—Ä–µ–∑ **FastAPI**.
2.  **Bot Container:** –°–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram (`apps/bot`) —Å—Ç–∞–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Game Core —á–µ—Ä–µ–∑ HTTP API.
3.  **UI Services Refactoring:** –°–ª–æ–π `ui_services` –±—É–¥–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API-—Ä–æ—É—Ç–∞–º–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ Python-—Ñ—É–Ω–∫—Ü–∏–π.

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ (Project Layout)

### `apps/` ‚Äî –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

#### üìÅ `apps/common/`
**–û–±—â–∏–π –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ.**
*   `core/`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞, DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
*   `database/`: –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –±–∞–∑–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –º–æ–¥–µ–ª–∏ ORM.
*   `resources/`: –û–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è LLM (`mode_preset.py`).
*   `services/`: –û–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `GeminiService`.

#### üìÅ `apps/game_core/`
**–Ø–¥—Ä–æ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏. –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Telegram.**
*   `game_service/`: –û—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (`CombatService`, `ThreatService`, `ZoneOrchestrator`).
*   `resources/`: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∏–≥—Ä—ã –¥–∞–Ω–Ω—ã–µ (`world_config.py`, `graf_data_world`).

#### üìÅ `apps/bot/`
**–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ —Å–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram.**
*   `handlers/`: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram-—Å–æ–±—ã—Ç–∏–π (—Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ–ª–±—ç–∫–∏).
*   `ui_services/`: –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ UI (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π).
*   `middlewares/`: Middleware –¥–ª—è `aiogram` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è DI).
*   `main.py`: –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞.

#### üìÅ `docs/`
**–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.**
*   `dis_docs/`: –î–∏–∑–∞–π–Ω-–¥–æ–∫—É–º–µ–Ω—Ç—ã (–õ–û–†, –º–µ—Ö–∞–Ω–∏–∫–∏, —Ç–µ—Ö. —Å–ø–µ–∫–∏).
*   `AI_instructions/`: –ü—Ä–æ–º–ø—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ò–ò.

#### üìÅ `scripts/`
**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.**
*   `seed_world_gen.py`: –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏—Ä–∞.
*   `debug_read_db.py`: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î.

---

## 4. –ü–æ—Ç–æ–∫ –î–∞–Ω–Ω—ã—Ö (Data Flow): 3-Tier Logic

–õ–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —á–∏—Å—Ç–æ—Ç—É –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∫–æ–¥–∞.

### üîª –£—Ä–æ–≤–µ–Ω—å 1: Handlers (–°–ª–æ–π –≤–≤–æ–¥–∞)
*   **–ì–¥–µ:** `apps/bot/handlers/`
*   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü—Ä–∏–µ–º –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram.
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π UI-—Å–µ—Ä–≤–∏—Å.

### üîª –£—Ä–æ–≤–µ–Ω—å 2: UI Services (–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
*   **–ì–¥–µ:** `apps/bot/ui_services/`
*   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∞ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –µ–µ –Ω–∞ –£—Ä–æ–≤–µ–Ω—å 3.

### üîª –£—Ä–æ–≤–µ–Ω—å 3: Game Services (–°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
*   **–ì–¥–µ:** `apps/game_core/game_service/` –∏ `apps/common/services/`
*   **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –í—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã: —Ä–∞—Å—á–µ—Ç—ã, —Ä–∞–±–æ—Ç–∞ —Å –ë–î —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, Gemini).
*   **–ü—Ä–∞–≤–∏–ª–æ:** –ù–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ Telegram. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ Python-–æ–±—ä–µ–∫—Ç—ã (DTO, –ø—Ä–∏–º–∏—Ç–∏–≤—ã).
