# üéí –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –°–∏—Å—Ç–µ–º–∞ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—è v3.0 (Smart Inventory)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Implemented & Refactored
**–í–µ—Ä—Å–∏—è:** 3.1 (Logic Helpers Integration)
**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `InventoryUIService`, `InventoryLogicHelpers`, `InventoryRepo`

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ü–æ–¥—Ö–æ–¥

–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ **3-Tier Architecture** —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ö–µ–ª–ø–µ—Ä.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1.  **UI Service (`InventoryUIService`):**
    * **Role:** Facade (–§–∞—Å–∞–¥).
    * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç Telegram (Callback).
    * –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `if/else` –ª–æ–≥–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
    * –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–ª–∞—Å—Å–∞–º (`_list_ui`, `_main_menu_ui`, `_details_ui`).
2.  **Logic Helper (`InventoryLogicHelpers`):**
    * **Role:** Pure Logic (–ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞).
    * –°–æ–¥–µ—Ä–∂–∏—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (`get_filtered_items`).
    * –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º–∏ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏ —Å–ª–æ—Ç–æ–≤.
    * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã (Quick Slots).
3.  **Repository (`InventoryRepo`):**
    * **Role:** Data Access.
    * CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î.

---

## 2. –ê–ª–≥–æ—Ä–∏—Ç–º "–£–º–Ω–æ–π –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏" (Smart Filtering)

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –≤ `InventoryLogicHelpers`.

### –í—Ö–æ–¥—è—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
* **Section:** –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª (`equip`, `resource`, `consumable`, `inventory`).
* **Category:** –£—Ç–æ—á–Ω—è—é—â–∏–π —Ñ–∏–ª—å—Ç—Ä (`all`, `weapon`, `ores`, `head_armor`).

### –õ–æ–≥–∏–∫–∞ –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (Pipeline):

1.  **–§–∏–ª—å—Ç—Ä –ø–æ –õ–æ–∫–∞—Ü–∏–∏ (Location Check):**
    * –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª **"–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å"** –∏–ª–∏ **"–ù–∞–¥–µ—Ç—å"** -> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `location='inventory'`. –ù–∞–¥–µ—Ç—ã–µ –≤–µ—â–∏ —Å–∫—Ä—ã—Ç—ã.
    * –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª **"–ö—É–∫–ª–∞"** -> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º `location='equipped'`.

2.  **–§–∏–ª—å—Ç—Ä –ø–æ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (Category Match):**
    * **Mode "ALL":** –ï—Å–ª–∏ `category == 'all'`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ —Å–µ–∫—Ü–∏–∏.
    * **Mode "RESOURCE GROUP":** –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ—Å—É—Ä—Å—ã, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥—Ç–∏–ø —á–µ—Ä–µ–∑ –º–∞–ø–ø–∏–Ω–≥:
        * `iron_ore` -> –≤—Ö–æ–¥–∏—Ç –≤ –≥—Ä—É–ø–ø—É `ores` -> ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å.
        * `linen_cloth` -> –≤—Ö–æ–¥–∏—Ç –≤ –≥—Ä—É–ø–ø—É `fabrics` -> ‚ùå –°–∫—Ä—ã—Ç—å (–µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä `ores`).
    * **Mode "EQUIPMENT SLOT":** –ï—Å–ª–∏ –º—ã –ø—Ä–∏—à–ª–∏ –∏–∑ –º–µ–Ω—é –ö—É–∫–ª—ã (–Ω–∞–∂–∞–ª–∏ –Ω–∞ "–ì–æ–ª–æ–≤—É"):
        * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–ª–µ `valid_slots` –≤ JSON-–¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–∞.
        * –ï—Å–ª–∏ `head_armor` –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ `valid_slots` –ø—Ä–µ–¥–º–µ—Ç–∞ -> ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å.
        * –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É –ø–æ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª—å—Ü–∞).
    * **Mode "ITEM TYPE":** (Legacy) –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ (`weapon`).

---

## 3. –ú–µ—Ö–∞–Ω–∏–∫–∞ Quick Slots (–ü–æ—è—Å)

–°–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –≤ –±–æ—é.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
* **–ë–î:** –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã "—Å–ª–æ—Ç–æ–≤".
* **–ü–æ–ª–µ:** –í `inventory_items` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `quick_slot_position` (Nullable String).
    * –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è: `"quick_slot_1"`, `"quick_slot_2"`.
* **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç:** –û–¥–∏–Ω —Å–ª–æ—Ç –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç. –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å—Ç–∞—Ä—ã–π "–æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç—Å—è" (–ø–æ–ª–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `NULL`).

### –†–∞—Å—á–µ—Ç –ª–∏–º–∏—Ç–∞
* –õ–∏–º–∏—Ç —Å–ª–æ—Ç–æ–≤ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π**.
* **–ë–∞–∑–∞:** 0 —Å–ª–æ—Ç–æ–≤.
* **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä:** –ü—Ä–µ–¥–º–µ—Ç –≤ —Å–ª–æ—Ç–µ `BELT_ACCESSORY` –¥–æ–±–∞–≤–ª—è–µ—Ç –±–æ–Ω—É—Å `quick_slot_capacity`.
* *–ü—Ä–∏–º–µ—Ä:* "–ö–æ–∂–∞–Ω—ã–π –ø–æ—è—Å" –¥–∞–µ—Ç +2 —Å–ª–æ—Ç–∞. –ò–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ [1], [2].

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ú–µ–Ω—é (UX Flow)

### –£—Ä–æ–≤–µ–Ω—å 0: "–ö—É–∫–ª–∞" (Main Menu)
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–¥–µ—Ç—ã—Ö –≤–µ—â–µ–π –ø–æ —Å–ª–æ—Ç–∞–º.
* –ö–Ω–æ–ø–∫–∏ —Å–ª–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ **–§–∏–ª—å—Ç—Ä—ã**: –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ "–ì–æ–ª–æ–≤—É" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —à–ª–µ–º–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ.
* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ó–∞–Ω—è—Ç–æ—Å—Ç—å —Ä—é–∫–∑–∞–∫–∞, –ó–æ–ª–æ—Ç–æ/–ü—ã–ª—å.

### –£—Ä–æ–≤–µ–Ω—å 1: –°–ø–∏—Å–∫–∏ (List View)
* –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã.
* **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** –°–µ—Ç–∫–∞ 3x3 (9 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É).
* **Sub-Menu:** –î–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Å–≤–µ—Ä—Ö—É –ø–æ—è–≤–ª—è—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`–†—É–¥—ã`, `–¢–∫–∞–Ω–∏`, `–ï–¥–∞`).

### –£—Ä–æ–≤–µ–Ω—å 2: –î–µ—Ç–∞–ª–∏ (Item Details)
* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞.
* **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:** –ï—Å–ª–∏ —ç—Ç–æ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—ã —Å –Ω–∞–¥–µ—Ç–æ–π –≤–µ—â—å—é –≤ —ç—Ç–æ—Ç —Å–ª–æ—Ç (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É `+5 –°–∏–ª—ã`).
* **–î–µ–π—Å—Ç–≤–∏—è:** –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (`–ù–∞–¥–µ—Ç—å`, `–°–Ω—è—Ç—å`, `–í —Å–ª–æ—Ç 1`, `–í—ã–±—Ä–æ—Å–∏—Ç—å`).