# üèóÔ∏è RFC-001: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¢—Ä–µ—Ö—Å–ª–æ–π–Ω—É—é –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (3-Tier)

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–∏–Ω—è—Ç –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é
**–î–∞—Ç–∞:** 2025-12-02
**–¶–µ–ª—å:** –ò–∑–æ–ª—è—Ü–∏—è —Å–ª–æ–µ–≤ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º (FastAPI).

---

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –°–ª–æ–µ–≤ (The 3-Layer Model)

–í–≤–æ–¥–∏—Ç—Å—è —Å—Ç—Ä–æ–≥–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ **—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑**.

### üîª Layer 1: Telegram Handlers (Controller)
* **–ì–¥–µ:** `app/handlers/...`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** "–ì–ª—É–ø—ã–π" –ø—Ä–æ–≤–æ–¥–Ω–∏–∫.
    1.  –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `Update` (Message/Callback).
    2.  –î–æ—Å—Ç–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (`user_id`, `state`).
    3.  **–î–µ–ª–µ–≥–∏—Ä—É–µ—Ç** –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `UI Service`.
    4.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (`edit_text`, `answer`).
* **‚õî –ó–ê–ü–†–ï–©–ï–ù–û:**
    * –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `GameService`, `Repositories`.
    * –í—ã–ø–æ–ª–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—Ä–∞—Å—á–µ—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π).
    * –†–∞–±–æ—Ç–∞—Ç—å —Å –ë–î –Ω–∞–ø—Ä—è–º—É—é.

### üîª Layer 2: UI Services (Presenter / Facade)
* **–ì–¥–µ:** `app/services/ui_service/...`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –§–∞—Å–∞–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    1.  **Orchestration (–î–µ–π—Å—Ç–≤–∏—è):** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –•—ç–Ω–¥–ª–µ—Ä–∞ ("–ò–≥—Ä–æ–∫ —Ö–æ—á–µ—Ç –≤ –±–æ–π") –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `GameService` (–∏–ª–∏ API –ö–ª–∏–µ–Ω—Ç –≤ –±—É–¥—É—â–µ–º).
    2.  **Presentation (–í—å—é—Ö–∏):** –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—É—Ö–∏–µ –¥–∞–Ω–Ω—ã–µ (DTO) –≤ HTML-—Ç–µ–∫—Å—Ç –∏ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
    3.  **State Management:** –†–µ—à–∞–µ—Ç, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º.
* **‚õî –ó–ê–ü–†–ï–©–ï–ù–û:**
    * –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ SQL (—á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏) ‚Äî *—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ GameService*.

### üîª Layer 3: Game Services (Domain Logic)
* **–ì–¥–µ:** `app/services/game_service/...`
* **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∏ –¥–∞–Ω–Ω—ã–µ.
    1.  –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Damage Calc, Inventory Ops, Matchmaking).
    2.  –†–∞–±–æ—Ç–∞ —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö (SQLAlchemy) –∏ –ö—ç—à–µ–º (Redis).
    3.  –í–æ–∑–≤—Ä–∞—Ç **—á–∏—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (DTO, bool, int).
* **‚õî –ó–ê–ü–†–ï–©–ï–ù–û:**
    * –ó–Ω–∞—Ç—å –ø—Ä–æ `aiogram`, `Message`, `CallbackQuery`.
    * –í–æ–∑–≤—Ä–∞—â–∞—Ç—å HTML –∏–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.

---

## 2. –ü–∞—Ç—Ç–µ—Ä–Ω "–§–∞—Å–∞–¥" –¥–ª—è –°–ª–æ–∂–Ω—ã—Ö –ú–æ–¥—É–ª–µ–π

–î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (–ê—Ä–µ–Ω–∞, –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å) —Å–æ–∑–¥–∞–µ—Ç—Å—è –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.

### UI Service (Facade)
–ö–ª–∞—Å—Å, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –º–µ—Ç–æ–¥—ã –¥–µ–π—Å—Ç–≤–∏–π (Actions) –∏ –º–µ—Ç–æ–¥—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (Views).
* `ui.action_equip_item(item_id)` -> –≤—ã–∑—ã–≤–∞–µ—Ç `logic.equip(item_id)`
* `ui.view_inventory_main()` -> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(text, kb)`

### Game Service (Facade)
–ö–ª–∞—Å—Å, —Å–∫—Ä—ã–≤–∞—é—â–∏–π –ø–æ–¥ —Å–æ–±–æ–π –ø–æ–¥-—Å–µ—Ä–≤–∏—Å—ã.
* `ArenaService` -> —É–ø—Ä–∞–≤–ª—è–µ—Ç `Arena1v1Service`, `ArenaGroupService`.

---

## 3. –°—Ö–µ–º–∞ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ü—Ä–∏–º–µ—Ä: –ê—Ä–µ–Ω–∞)

**–ë—ã–ª–æ (–°–º–µ—à–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å):**
* –•—ç–Ω–¥–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç `ArenaService`.
* –•—ç–Ω–¥–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `ArenaService.join_queue()`.
* –•—ç–Ω–¥–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç `ArenaUIBuilder`.
* –•—ç–Ω–¥–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `builder.render()`.

**–°—Ç–∞–ª–æ (3-Tier):**
* –•—ç–Ω–¥–ª–µ—Ä —Å–æ–∑–¥–∞–µ—Ç `ArenaUIService`.
* –•—ç–Ω–¥–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `ui.action_join_queue()`.
* –•—ç–Ω–¥–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç `ui.view_search_screen()`.