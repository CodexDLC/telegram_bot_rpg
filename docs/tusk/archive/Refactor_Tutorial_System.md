# üéì Refactoring: Tutorial System (Legacy to Core)

> **Status:** Completed / Archived
> **Date:** 2023-10-27
> **Outcome:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ Scenario Engine (Quest System).

## 1. –ü—Ä–æ–±–ª–µ–º–∞ (Legacy State)
–¢–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å `apps/bot/handlers/callback/tutorial` –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞.
*   **Fake Data:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î.
*   **No Core:** –ù–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å `InventoryService`, `CombatManager`, `SkillService`.
*   **Hardcode:** –õ–æ–≥–∏–∫–∞ "–∑–∞—à–∏—Ç–∞" –≤ —Ö—ç–Ω–¥–ª–µ—Ä—ã, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç Clean Architecture.

## 2. –†–µ—à–µ–Ω–∏–µ (Implemented Architecture)

–í–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ `TutorialService` –±—ã–ª–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (**Scenario Engine**). –¢—É—Ç–æ—Ä–∏–∞–ª —Å—Ç–∞–ª –ø–µ—Ä–≤—ã–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º (`awakening_rift`), —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —ç—Ç–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.

### 2.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
*   **ScenarioCoreOrchestrator:** –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
*   **TutorialHandler:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å (`apps/game_core/game_service/scenario_orchestrator/handlers/tutorial_handler.py`), –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–æ–≤, –≤—ã–¥–∞—á–∞ –Ω–∞–≥—Ä–∞–¥).
*   **JSON Config:** –í–µ—Å—å —Ç–µ–∫—Å—Ç –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ JSON.

### 2.2. –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
1.  **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–æ–≤:** –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–ª–∞—Å—Å–∞, –∏–≥—Ä–æ–∫ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç "–≤–µ—Å–∞" —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —á–µ—Ä–µ–∑ –¥–µ–π—Å—Ç–≤–∏—è. –í –∫–æ–Ω—Ü–µ —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±–∏–ª–¥.
2.  **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞:** –ü—Ä–µ–¥–º–µ—Ç—ã –∏ –Ω–∞–≤—ã–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ `loot_queue` –∏ –≤—ã–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.
3.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (`InventoryRepo`, `SkillProgressRepo`) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

## 3. –°—Å—ã–ª–∫–∏
*   –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º: `docs/dis_docs/04_Technical_Specs/07_Scenario_JSON_Structure.md`
*   –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è: `docs/dis_docs/04_Technical_Specs/08_Scenarios/01_Awakening_Rift.md`
