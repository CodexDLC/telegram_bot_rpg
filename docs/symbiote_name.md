Таск: "Пробуждение Симбиота" (Система именования)
Цель: Реализовать механику, позволяющую игроку дать "системному помощнику" (симбиоту) кастомное имя, которое будет использоваться во всех UI-сообщениях.

Шаги к реализации:

1. Бэкенд (База данных):

Задача: Добавить поле для хранения имени симбиота.

Действие: В таблице, где хранится информация о персонаже (или игроке, Player, Character и т.п.), добавить новую колонку.

Спецификация:

name: symbiote_name (или symbiont_name, assistant_name)

type: VARCHAR (например, 255)

default: 'Система' (или 'System', как ты решил)

nullable: False (не должно быть пустым, всегда есть дефолт).

2. Логика (Сервисный слой):

Задача: Нужна функция, которая безопасно обновит это имя в БД.

Действие: Создать (или дополнить) сервисный класс, отвечающий за персонажа.

Спецификация:

Создать асинхронную функцию async set_symbiote_name(user_id: int, new_name: str).

Функция должна включать валидацию new_name (проверка длины, отсутствия мата — можно сделать позже, но запланировать).

Функция обновляет поле в БД для user_id.

3. FSM (Конечные автоматы):

Задача: Создать состояние, в котором бот будет ожидать ввода имени.

Действие: В файле app/resources/fsm_states/states.py (или аналоге) добавить новое состояние.

Спецификация:

Добавить состояние, например: SYMBIOTE_NAMING = State()

Добавить его в группу состояний, которая будет "ловить" только текст, а не колбэки.

4. Хэндлеры (Обработчики):

Задача: Создать хэндлеры для запуска и завершения процесса именования.

Действие (Запуск):

Пока нет квеста: Сделать временную админ-команду (или просто команду /set_name), которая переводит игрока в состояние SYMBIOTE_NAMING и отправляет сообщение: "Я пробуждаюсь... Как ты будешь меня называть?"

Действие (Завершение):

Создать хэндлер, который ловит сообщение (не колбэк) в состоянии SYMBIOTE_NAMING.

Логика хэндлера:

Получить текст: new_name = message.text

Вызвать сервис: await set_symbiote_name(user_id, new_name) (с валидацией).

Отправить подтверждение: f"Отныне, зови меня {new_name}. Я к твоим услугам, {char_name}."

Сбросить состояние: await state.clear() (или вернуть в LOBBY).

5. UI (Интеграция в интерфейс):

Задача: Все тексты должны использовать symbiote_name.

Действие:

Во все сервисные функции, генерирующие текст (типа group_skill из character_status_service.py), добавить обязательный параметр symbiote_name: str.

Во всех хэндлерах (как status_menu_start_handler), перед вызовом UI-сервиса, получить symbiote_name из данных персонажа (из FSM или из БД).

Передать symbiote_name в UI-сервис.

Заменить все "захардкоженные" обращения ("Система:", "<b>Персонаж:</b>") на f"<b>{symbiote_name}:</b>".

6. Гейм-дизайн (Будущее):

Задача: Интегрировать запуск именования в квест.

Действие: Убрать временную команду (из п.4) и вместо нее вызывать тот же код (перевод в SYMBIOTE_NAMING) из логики твоего квеста "пробуждения".

Начинать нужно по порядку: 1. База -> 2. Логика (Сервис) -> 5. UI (подготовка функций) -> 3+4 (FSM и Хэндлеры для теста).