# Item Creation Pipeline (–ö–æ–Ω–≤–µ–π–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤)

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Item System](../README.md) | [üè† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Root)](../../../../README.md)

---

## üìã –û–±–∑–æ—Ä
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ ‚Äî –æ—Ç –≤—ã–±–æ—Ä–∞ –±–∞–∑—ã –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –ë–î.

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **ItemAssembler** ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ —Å–±–æ—Ä–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
2. **ItemDistributionService** ‚Äî —Å–µ—Ä–≤–∏—Å –≤—ã–¥–∞—á–∏ –ª—É—Ç–∞.
3. **LootService** ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –¥—Ä–æ–ø–∞.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```mermaid
graph TD
    Event[Game Event: Kill/Craft] --> LootService
    LootService -->|Roll Chance & Tier| ItemDist[ItemDistributionService]
    ItemDist -->|Select Base| Assembler[ItemAssembler]
    Assembler -->|Load DTOs| Base[BaseItemDTO]
    Assembler -->|Load DTOs| Mat[MaterialDTO]
    Assembler -->|Calculate Stats| Payload[JSON Payload]
    Payload --> ItemDist
    ItemDist -->|Save to DB| Repo[InventoryRepo]
    Repo -->|Return Item| Player[Player Inventory]
```

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 1: ItemAssembler

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–±–æ—Ä ID (base, material, bundle) –≤ –≥–æ—Ç–æ–≤—ã–π JSON payload –ø—Ä–µ–¥–º–µ—Ç–∞.

### –ú–µ—Ç–æ–¥: `assemble_equipment()`
**–í—Ö–æ–¥:** `base_id`, `target_tier`, `bundle_id` (–æ–ø—Ü).
**–í—ã—Ö–æ–¥:** `item_type`, `subtype`, `rarity`, `data_payload`.

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–±–æ—Ä–∫–∏
1.  **–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã:** –ü–æ–ª—É—á–µ–Ω–∏–µ `BaseItemDTO` (—Å—Ç–∞—Ç—ã, —Ç—Ä–∏–≥–≥–µ—Ä—ã).
2.  **–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:** –ü–æ–ª—É—á–µ–Ω–∏–µ `MaterialDTO` (–º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∏—Ä–∞).
3.  **–†–∞—Å—á—ë—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫:**
    *   `Final_Power = Base_Power * Material_Mult * Variance`
    *   `Max_Durability = Base_Durability * Material_Mult`
4.  **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞—Ñ—Ñ–∏–∫—Å–æ–≤:**
    *   –í—ã–±–æ—Ä –±–∞–Ω–¥–ª–æ–≤ (Primary + Random).
    *   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –≤ `bonuses` –∏ `triggers`.
5.  **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏:** "–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á <Vampirism>".

---

## üé≤ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 2: LootService

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≤—ã–ø–∞–¥–∞–µ—Ç –ª–∏ –ª—É—Ç –∏ –∫–∞–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.

### –ê–ª–≥–æ—Ä–∏—Ç–º
1.  **Roll Drop:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–Ω—Å–∞ –≤—ã–ø–∞–¥–µ–Ω–∏—è (—Å —É—á–µ—Ç–æ–º —É–¥–∞—á–∏).
2.  **Roll Tier:** –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏—Ä–∞ (–•–ª–∞–º / –ù–æ—Ä–º–∞ / –î–∂–µ–∫–ø–æ—Ç).
3.  **–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—ã–∑–æ–≤ `ItemDistributionService`.

---

## üéÅ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 3: ItemDistributionService

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥–º–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ –ë–î.

### –ê–ª–≥–æ—Ä–∏—Ç–º
1.  **–í—ã–±–æ—Ä –±–∞–∑—ã:** –°–ª—É—á–∞–π–Ω–∞—è –±–∞–∑–∞ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
2.  **–°–±–æ—Ä–∫–∞:** –í—ã–∑–æ–≤ `ItemAssembler`.
3.  **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `inventory_items`.
    *   *–í–∞–∂–Ω–æ:* –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (SYSTEM), –∑–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫—É.
4.  **–ü–µ—Ä–µ–¥–∞—á–∞:** –°–º–µ–Ω–∞ `owner_id` –Ω–∞ ID –∏–≥—Ä–æ–∫–∞.

---

## ü§ñ LLM Integration (Gemini)
*–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è.*
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π (`description`) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–≥–æ–≤ –ø—Ä–µ–¥–º–µ—Ç–∞ ("–¥—Ä–µ–≤–Ω–∏–π", "–æ–≥–Ω–µ–Ω–Ω—ã–π", "–º–µ—á").
