# Combat Integration (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ–µ–º)

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Item System](../README.md) | [üè† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Root)](../../../../README.md)

---

## üìã –û–±–∑–æ—Ä
–ü—Ä–µ–¥–º–µ—Ç—ã –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –±–æ—é –Ω–∞–ø—Ä—è–º—É—é. –û–Ω–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —á–∏—Å–ª–æ–≤—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤ Redis (`v:raw`).

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

1.  **PostgreSQL:** `InventoryItemDTO` (–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).
2.  **ContextAssembler:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç–∞—Ç—ã –∏ –±–æ–Ω—É—Å—ã.
3.  **Redis:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `math_model` (—á–∏—Å–ª–∞) –∏ `loadout` (—Ç—Ä–∏–≥–≥–µ—Ä—ã).
4.  **StatsEngine:** –°—á–∏—Ç–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —É—Ä–æ–Ω.
5.  **CombatResolver:** –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã.

---

## ‚öôÔ∏è –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è (ContextAssembler)

### 1. –ß–∏—Å–ª–æ–≤—ã–µ —Å—Ç–∞—Ç—ã (Math Model)
–ü–æ–ª—è `power`, `accuracy`, `crit_chance` –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:
*   `main_hand_damage_base`
*   `main_hand_accuracy`
*   `main_hand_crit_chance`

### 2. –ë–æ–Ω—É—Å—ã (Bonuses)
*   `implicit_bonuses` (–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∞) -> `modifiers`
*   `bonuses` (–æ—Ç –∞—Ñ—Ñ–∏–∫—Å–æ–≤) -> `modifiers`

### 3. –¢—Ä–∏–≥–≥–µ—Ä—ã (Loadout)
–¢—Ä–∏–≥–≥–µ—Ä—ã (`triggers`) –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–∏—Å–ª–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `loadout`:
```json
"loadout": {
    "weapon_triggers": {
        "main_hand": ["trigger_bleed"],
        "off_hand": []
    }
}
```

---

## ‚öîÔ∏è –í –±–æ—é (CombatResolver)
–ü—Ä–∏ –∞—Ç–∞–∫–µ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `loadout` –∞—Ç–∞–∫—É—é—â–µ–≥–æ.
–ï—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `trigger_bleed`) –∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (Crit), –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç.
