# üèüÔ∏è Domain: Arena
**Status:** üî¥ Refactoring

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ
–ê—Ä–µ–Ω–∞ ‚Äî —ç—Ç–æ –∏–≥—Ä–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è (–∑–¥–∞–Ω–∏–µ), –≥–¥–µ –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö PvP-–±–æ—è—Ö: –¥—É—ç–ª–∏ 1x1, –≥—Ä—É–ø–ø–æ–≤—ã–µ –±–æ–∏, —Ç—É—Ä–Ω–∏—Ä—ã. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥ –ø–æ GearScore, –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—è —Å AI-–ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–º (–¢–µ–Ω—å—é) –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ.

## üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
*   **Matchmaking** ‚Äî –ø–æ–¥–±–æ—Ä –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø–æ GearScore (GS) —Å —Ä–∞—Å—à–∏—Ä—è—é—â–∏–º—Å—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –ø–æ–∏—Å–∫–∞
*   **Queue** ‚Äî –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –≤ Redis (ZSET, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ GS)
*   **Shadow Battle** ‚Äî –±–æ–π —Å AI –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –ø–æ–∏—Å–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
*   **Polling** ‚Äî –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –º–∞—Ç—á–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –æ–∂–∏–¥–∞–Ω–∏—è

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (Target V2)

### Backend
`backend/domains/user_features/arena/`
*   `api/arena.py` ‚Äî FastAPI —Ä–æ—É—Ç–µ—Ä
*   `gateway/arena_gateway.py` ‚Äî –£–ø–∞–∫–æ–≤–∫–∞ CoreResponseDTO
*   `services/arena_service.py` ‚Äî –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥–∞
*   `dto/arena_dto.py` ‚Äî Payload DTO
*   `data/arena_resources.py` ‚Äî –¢–µ–∫—Å—Ç—ã, –∫–Ω–æ–ø–∫–∏

### Client
`game_client/telegram_bot/features/arena/`
*   `client.py` ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç –∫ Backend API
*   `handlers/arena_handler.py` ‚Äî –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä (–≤—Å–µ action —á–µ—Ä–µ–∑ callback_data)
*   `resources/keyboards/arena_callback.py` ‚Äî CallbackData –∫–ª–∞—Å—Å—ã
*   `resources/formatters/arena_formatter.py`
*   `system/arena_bot_orchestrator.py`
*   `system/arena_ui_service.py`

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
*   **Redis:** ArenaManager (–æ—á–µ—Ä–µ–¥–∏, –∑–∞—è–≤–∫–∏)
*   **Combat:** SystemDispatcher.combat_entry() (—Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—è)
*   **Account:** AccountSessionService (–ø–æ–ª—É—á–µ–Ω–∏–µ char_id)

## üìä –†–µ–∂–∏–º—ã –∞—Ä–µ–Ω—ã
| –†–µ–∂–∏–º | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **1v1** | üü¢ MVP | –î—É—ç–ª—å –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ |
| **Group** | üî¥ Future | –ö–æ–º–∞–Ω–¥–Ω—ã–µ –±–æ–∏ |
| **Tournament** | üî¥ Future | –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ |

## üîÑ Flow
1.  –ò–≥—Ä–æ–∫ –≤—Ö–æ–¥–∏—Ç –≤ Arena ‚Üí `BotState.arena`
2.  –í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∂–∏–º (1v1) ‚Üí –ø–æ–∫–∞–∑ –º–µ–Ω—é —Ä–µ–∂–∏–º–∞
3.  –ù–∞–∂–∏–º–∞–µ—Ç "–ù–∞–π—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞" ‚Üí `join_queue` + polling —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
4.  –ú–∞—Ç—á –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—è (PvP –∏–ª–∏ Shadow)
5.  –ü–µ—Ä–µ—Ö–æ–¥ –≤ `BotState.combat`