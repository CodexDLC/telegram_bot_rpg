# üìú Domain: Scenario (Quests & Dialogs)

> **Status:** ‚úÖ Active / Stable (Refactored)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ
–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–º –Ω–∞—Ä—Ä–∞—Ç–∏–≤–æ–º.
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É **–¥–∏–∞–ª–æ–≥–æ–≤**, **–∫–≤–µ—Å—Ç–æ–≤**, **—Ç—É—Ç–æ—Ä–∏–∞–ª–∞** –∏ –ª—é–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ –≥—Ä–∞—Ñ–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–æ–¥.

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
1.  **Graph-Based Engine:** –°—Ü–µ–Ω–∞—Ä–∏–π ‚Äî —ç—Ç–æ –≥—Ä–∞—Ñ –Ω–æ–¥ (Nodes), —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ (Edges/Actions).
2.  **State Management:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ (—Ç–µ–∫—É—â–∞—è –Ω–æ–¥–∞, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞) —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis (Hot) –∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ PostgreSQL (Cold).
3.  **Handlers System:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∏—Å–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é –ª–æ–≥–∏–∫—É (Python-–∫–æ–¥) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–≥—Ä–∞–¥ –≤ –¢—É—Ç–æ—Ä–∏–∞–ª–µ).
4.  **JSON-Driven:** –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç (—Ç–µ–∫—Å—Ç—ã, —Å–≤—è–∑–∏, —É—Å–ª–æ–≤–∏—è) –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ JSON-—Ñ–∞–π–ª–∞—Ö.

## üìÇ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Backend)

`backend/domains/user_features/scenario/`

*   **api/**: HTTP Endpoints (`initialize`, `step`).
*   **service/**:
    *   `ScenarioService`: –§–∞—Å–∞–¥ –¥–æ–º–µ–Ω–∞.
    *   `SessionService`: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π –∏–≥—Ä–æ–∫–∞.
*   **engine/**:
    *   `ScenarioDirector`: –î–≤–∏–∂–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π).
    *   `ScenarioFormatter`: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–≤–µ—Ç–∞ (DTO).
*   **handlers/**: –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–æ–≥–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TutorialHandler`).
*   **resources/**:
    *   `loaders/`: –ó–∞–≥—Ä—É–∑–∫–∞ JSON –≤ –ë–î.
    *   `json/`: –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
*   **Account Domain:** –ü–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫–∞ –≤ —Ä–µ–∂–∏–º `SCENARIO` –∏ –æ–±—Ä–∞—Ç–Ω–æ.
*   **Inventory/Combat:** –í—ã–¥–∞—á–∞ –Ω–∞–≥—Ä–∞–¥, –∑–∞–ø—É—Å–∫ –±–æ–µ–≤ (—á–µ—Ä–µ–∑ Handlers).
