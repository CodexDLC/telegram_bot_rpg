# üìÇ Scenario API Layer

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Scenario Domain](../README.md)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ
–°–ª–æ–π HTTP API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥–æ–º–µ–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç endpoints –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–≤–µ—Å—Ç–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤.

## üó∫Ô∏è –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### üìÑ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
–ù–∏–∂–µ –æ–ø–∏—Å–∞–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã API.

---

## Endpoints

### 1. Initialize Scenario

–ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.

- **URL:** `POST /scenario/initialize`
- **Query Params:** `char_id` (int)
- **Body:** `ScenarioInitDTO`

```json
{
  "quest_key": "awakening_rift",
  "node_id": null  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å—Ç–∞—Ä—Ç —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥—ã (–¥–ª—è –¥–µ–±–∞–≥–∞)
}
```

**Response:** `CoreResponseDTO[ScenarioPayloadDTO]`

```json
{
  "header": {
    "current_state": "scenario"
  },
  "payload": {
    "node_key": "start_node",
    "text": "–í—ã –æ—á–Ω—É–ª–∏—Å—å –≤ —Ç–µ–º–Ω–æ–º –ª–µ—Å—É...",
    "buttons": [
      {
        "label": "–û—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è",
        "action_id": "look_around"
      }
    ],
    "status_bar": ["HP: 100/100"],
    "is_terminal": false,
    "extra_data": {
      "char_id": 123
    }
  }
}
```

---

### 2. Step Scenario

–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏) –≤ —Ç–µ–∫—É—â–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏.

- **URL:** `POST /scenario/step`
- **Query Params:**
  - `char_id` (int)
  - `action_id` (str) - ID –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ –∫–Ω–æ–ø–∫–∏

**Response:** `CoreResponseDTO[ScenarioPayloadDTO]`

**–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:**

1. **–°–ª–µ–¥—É—é—â–∞—è —Å—Ü–µ–Ω–∞ (–æ–±—ã—á–Ω—ã–π —à–∞–≥):**
   `header.current_state` = `"scenario"`
   `payload` = –ù–æ–≤–∞—è —Å—Ü–µ–Ω–∞ (—Ç–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∏).

2. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±–æ–π):**
   `header.current_state` = `"combat"`
   `payload` = –î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—è (CombatViewDTO).

---

## Data Models

### ScenarioPayloadDTO

–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –æ—Ç–≤–µ—Ç–∞, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ç–µ–∫—É—â—É—é —Å—Ü–µ–Ω—É.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `node_key` | str | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ–∫—É—â–µ–π –Ω–æ–¥—ã |
| `text` | str | –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (HTML formatting allowed) |
| `buttons` | list[Button] | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π |
| `status_bar` | list[str] | –°—Ç—Ä–æ–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (HP, MP) |
| `is_terminal` | bool | –§–ª–∞–≥ –∫–æ–Ω—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è (–æ–±—ã—á–Ω–æ false, —Ç.–∫. –ø—Ä–∏ true –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥) |
| `extra_data` | dict | –î–æ–ø. –¥–∞–Ω–Ω—ã–µ (char_id, image_url –∏ —Ç.–¥.) |

### ScenarioButtonDTO

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `label` | str | –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ |
| `action_id` | str | ID –¥–µ–π—Å—Ç–≤–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–π –≤ `/step` |
