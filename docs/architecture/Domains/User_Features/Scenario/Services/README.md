# üìÇ Scenario Services Layer

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Scenario Domain](../README.md)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ
–°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏. –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π, –≤—ã–∑–æ–≤ –¥–≤–∏–∂–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤.

## üó∫Ô∏è –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### üìÑ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### 1. ScenarioService
**File:** `service/scenario_service.py`
–§–∞—Å–∞–¥ –¥–æ–º–µ–Ω–∞.
- `initialize_payload()`: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–µ—Å—Ç–∞, —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏.
- `step_payload()`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–∑–æ–≤ Director, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
- `finalize_scenario()`: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞, –≤—ã–¥–∞—á–∞ –Ω–∞–≥—Ä–∞–¥, –æ—á–∏—Å—Ç–∫–∞.

#### 2. ScenarioSessionService
**File:** `service/session_service.py`
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏–∏.
- –†–∞–±–æ—Ç–∞ —Å Redis (Hot State).
- –ë—ç–∫–∞–ø—ã –≤ PostgreSQL (Cold State).
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ (`state`, `active_quest`).

---

## ‚öôÔ∏è Engine Components

#### ScenarioDirector
**File:** `engine/director.py`
–î–≤–∏–∂–æ–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∞—è –Ω–æ–¥–∞ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö (Conditions) –∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö (Actions).

#### ScenarioFormatter
**File:** `engine/formatter.py`
–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–æ–¥—ã –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–≥–æ–≤, –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö).
