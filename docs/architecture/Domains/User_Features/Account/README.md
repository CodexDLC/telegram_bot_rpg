# Account Domain - Overview

## ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

Account Domain ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹:
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Telegram Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°Ğ¼Ğ¸ (Lobby)
- Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ¸Ğ³Ñ€Ñƒ Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ ÑĞµÑÑĞ¸Ğ¸ (Login + Resume Session)

Ğ­Ñ‚Ğ¾ **ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°** Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ `/start` Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°.

---

## ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### 1. Registration
Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ Ğ‘Ğ”.
- **Trigger:** `/start` ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ² Ğ±Ğ¾Ñ‚Ğµ
- **Action:** Upsert Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `users`
- **Result:** ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½

### 2. Lobby
Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.
- **List:** ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹ (ĞºÑÑˆ Redis â†’ Ğ‘Ğ”)
- **Create:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»Ğ²Ğ°Ğ½ĞºÑƒ Ğ´Ğ»Ñ Onboarding
- **Delete:** Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°
- **Select:** Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¸Ğ³Ñ€Ñƒ

### 3. Login (Resume Session)
Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ¸Ğ³Ñ€Ñƒ Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ.
- Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ `ac:{char_id}` (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ domain + context)
- Ğ’Ñ‹Ğ·Ğ¾Ğ² Context Assembler â†’ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ’Ñ‹Ğ·Ğ¾Ğ² System Dispatcher â†’ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½
- **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Ğ˜Ğ³Ñ€Ğ¾Ğº Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ‚ÑƒĞ´Ğ°, Ğ³Ğ´Ğµ Ğ±Ñ‹Ğ» (Combat, Exploration, Scenario Ğ¸ Ñ‚.Ğ´.)

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ ÑĞ»Ğ¾Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client (Telegram Bot)                  â”‚
â”‚  â”œâ”€ /start â†’ Registration               â”‚
â”‚  â”œâ”€ Select Character â†’ Login            â”‚
â”‚  â””â”€ Lobby Menu â†’ Lobby Actions          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Layer (FastAPI Endpoints)          â”‚
â”‚  â”œâ”€ POST /account/register              â”‚
â”‚  â”œâ”€ POST /account/lobby/initialize      â”‚
â”‚  â”œâ”€ POST /account/login                 â”‚
â”‚  â””â”€ DELETE /account/characters/{id}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Orchestrator Layer                     â”‚
â”‚  â””â”€ AccountOrchestrator                 â”‚
â”‚     â”œâ”€ ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸      â”‚
â”‚     â””â”€ Ğ’Ñ‹Ğ·Ğ¾Ğ² Dispatcher Ğ´Ğ»Ñ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer                          â”‚
â”‚  â”œâ”€ RegistrationService                 â”‚
â”‚  â”œâ”€ LobbyService (Cache-Aside)          â”‚
â”‚  â””â”€ LoginService (Resume Session)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer                             â”‚
â”‚  â”œâ”€ UsersRepoORM (PostgreSQL)           â”‚
â”‚  â”œâ”€ CharactersRepoORM (PostgreSQL)      â”‚
â”‚  â””â”€ AccountManager (Redis)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸

### â†’ Context Assembler
Login Service Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Context Assembler Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸ Ğ² Redis.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
# ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°
domain = "combat"  # ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ Ğ¸Ğ· ac:{char_id}
context_data = await context_assembler.prepare_session(char_id, domain)
# Redis Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ cs:{session_id} Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ±Ğ¾Ñ
```

### â†’ System Dispatcher
Login Service Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Dispatcher, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ view Ğ´Ğ»Ñ UI.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
payload = await dispatcher.get_initial_view(
    target_state="combat",
    char_id=123,
    action="resume"
)
# Dispatcher ÑĞ°Ğ¼ Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ CombatOrchestrator.get_entry_point()
```

### â†’ Onboarding Domain
Lobby Ğ¿ĞµÑ€ĞµĞ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ° Onboarding ĞµÑĞ»Ğ¸ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµÑ‚ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹.

---

## Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

### âœ… Ğ§Ñ‚Ğ¾ ÑƒĞ¶Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ (legacy):
- UsersRepoORM (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹)
- LobbyOrchestrator + LobbySessionManager (Cache-Aside Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½)
- Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Login Service (Ğ¿Ñ€Ğ¸Ğ¼Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)

### ğŸš§ Ğ§Ñ‚Ğ¾ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¼:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ HTTP API endpoints
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Context Assembler
- Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼ Resume Session Ñ‡ĞµÑ€ĞµĞ· Dispatcher
- ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ¸Ğ¼ DTO Ğ² `common/schemas/`

### âŒ Ğ§Ñ‚Ğ¾ ĞµÑ‰Ñ‘ Ğ½Ğµ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾:
- Logout Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ)
- Smart Routing (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°)
- ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Auth ĞºĞ¾Ğ´Ğ°

---

## ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸

- **[Manifest](./Manifest.md)** - ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°
- **[API](./API/)** - Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ HTTP endpoints
- **[Data](./Data/)** - DTOs Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- **[Orchestrator](./Orchestrator/)** - Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
- **[Client Interface](./Client_Interface/)** - Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Telegram Ğ±Ğ¾Ñ‚Ğ¾Ğ¼
- **[Roadmap](./Roadmap/)** - ĞŸĞ»Ğ°Ğ½ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ
