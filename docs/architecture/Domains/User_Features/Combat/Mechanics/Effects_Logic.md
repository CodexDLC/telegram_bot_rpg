# üß† Mechanic: Status Effects (–≠—Ñ—Ñ–µ–∫—Ç—ã)

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Combat Mechanics](./README.md) | [üíæ –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö](../../../../../Core/RPG_Rules/Data_Schemas/Effect_Schema.md)

---

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
–≠—Ñ—Ñ–µ–∫—Ç—ã –≤ RPG ‚Äî —ç—Ç–æ **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (States), –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1.  **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –®–∞–±–ª–æ–Ω–∞ –∏ –ò–Ω—Å—Ç–∞–Ω—Å–∞:**
    *   **Library (EffectConfigDTO):** "–†–µ—Ü–µ–ø—Ç" —ç—Ñ—Ñ–µ–∫—Ç–∞. –•—Ä–∞–Ω–∏—Ç –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (—á—Ç–æ –º–µ–Ω—è—Ç—å, –∫–∞–∫ –≤–µ—Å—Ç–∏ —Å–µ–±—è). –ù–µ–∏–∑–º–µ–Ω–µ–Ω.
    *   **Instance (ActiveEffectDTO):** "–ê–∫—Ç–∏–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç". –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏, –∫—Ç–æ –Ω–∞–ª–æ–∂–∏–ª, –∫–∞–∫—É—é —Å–∏–ª—É –∏–º–µ–µ—Ç).

2.  **Stateful Apply/Revert (–î–ª—è –°—Ç–∞—Ç–æ–≤):**
    *   –≠—Ñ—Ñ–µ–∫—Ç—ã, –º–µ–Ω—è—é—â–∏–µ —Å—Ç–∞—Ç—ã (Buff/Debuff), —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "–ù–∞—Å–ª–µ–¥–∏–ª ‚Äî –£–±–µ—Ä–∏".
    *   –ü—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `temp` –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–æ—Ä–∞.
    *   –≠—Ñ—Ñ–µ–∫—Ç **–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç**, –∫–∞–∫–∏–µ –∫–ª—é—á–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª (`modified_keys`).
    *   –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏ –ø–æ —ç—Ç–∏–º –∫–ª—é—á–∞–º.
    *   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç `StatsEngine` —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ (Waterfall), –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—è –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–ª–æ–∂–µ–Ω–∏–π.

3.  **Data-Driven Control (–î–ª—è –õ–æ–≥–∏–∫–∏):**
    *   –≠—Ñ—Ñ–µ–∫—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—è (–°—Ç–∞–Ω, –°–æ–Ω) –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è –≤ –¥–≤–∏–∂–∫–µ –∫–∞–∫ `if is_stun`.
    *   –û–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** (`ControlInstructionDTO`): "–ï—Å–ª–∏ —ç—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –ê—Ç–∞–∫—É—é—â–µ–º, –∑–∞–ø—Ä–µ—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–µ".
    *   –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç—Ä–æ–ª—è (–û–ø—å—è–Ω–µ–Ω–∏–µ, –°—Ç—Ä–∞—Ö) —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥–∏.

4.  **No Instant Effects:**
    *   –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (`duration > 0`).
    *   –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–•–∏–ª, –£—Ä–æ–Ω) ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –ê–±–∏–ª–∫–∏ (`instant_impact`), –∞ –Ω–µ –≠—Ñ—Ñ–µ–∫—Ç–∞.

---

## 2. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –¶–∏–∫–ª (Lifecycle)

### –ü—Ä–∏–º–µ—Ä: –ù–∞–ª–æ–∂–µ–Ω–∏–µ –ë–∞—Ñ—Ñ–∞ "–°–∏–ª–∞ –ú–µ–¥–≤–µ–¥—è" (+5 Str)

#### –®–∞–≥ 1. –ù–∞–ª–æ–∂–µ–Ω–∏–µ (Apply)
*   **AbilityService** —Å–æ–∑–¥–∞–µ—Ç `ActiveEffectDTO` —Å `uid="eff_123"`.
*   –ß–∏—Ç–∞–µ—Ç `raw_modifiers` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞: `{"strength": 5.0}`.
*   –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞—Ç–æ–≤ –∞–∫—Ç–æ—Ä–∞ (`ActorRawDTO`):
    ```python
    actor.raw.modifiers["strength"]["temp"]["eff_123"] = 5.0
    ```
*   –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–ª—é—á –≤ —ç—Ñ—Ñ–µ–∫—Ç–µ:
    ```python
    active_effect.modified_keys = ["strength"]
    ```
*   –î–æ–±–∞–≤–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –≤ —Å–ø–∏—Å–æ–∫ `actor.statuses.effects`.

#### –®–∞–≥ 2. –†–∞–±–æ—Ç–∞ (Runtime)
*   **StatsEngine** –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –±–µ—Ä–µ—Ç `base` (10) –∏ —Å—É–º–º–∏—Ä—É–µ—Ç –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `temp`.
*   –†–µ–∑—É–ª—å—Ç–∞—Ç: `10 + 5 = 15`.

#### –®–∞–≥ 3. –°–Ω—è—Ç–∏–µ (Revert)
*   –¢–∞–π–º–µ—Ä –∏—Å—Ç–µ–∫ (`expire_at <= current_turn`).
*   **AbilityService** (Cleanup) —á–∏—Ç–∞–µ—Ç `modified_keys` –∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞: `["strength"]`.
*   –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ UID:
    ```python
    del actor.raw.modifiers["strength"]["temp"]["eff_123"]
    ```
*   –£–¥–∞–ª—è–µ—Ç —Å–∞–º `ActiveEffectDTO` –∏–∑ —Å–ø–∏—Å–∫–∞.
*   **StatsEngine** –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—ã. –†–µ–∑—É–ª—å—Ç–∞—Ç: `10`.
