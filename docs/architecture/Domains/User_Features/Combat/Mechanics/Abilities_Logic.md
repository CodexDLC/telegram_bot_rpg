# üß† Logic: Abilities & Feints (–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –ü—Ä–∏–µ–º—ã)

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Mechanics](./README.md) | [üíæ –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö](../../../../Core/RPG_Rules/Data_Schemas/Ability_Schema.md)

---

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–í –±–æ–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä—è—é—Ç –±–∞–∑–æ–≤—É—é –∞—Ç–∞–∫—É:

### 1. Abilities (–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
*   **–°—É—Ç—å:** –ú–∞–≥–∏—è, —Å–ø–µ—Ü–ø—Ä–∏–µ–º—ã, –º–æ—â–Ω—ã–µ —É–¥–∞—Ä—ã.
*   **–†–µ—Å—É—Ä—Å:** –¢—Ä–∞—Ç—è—Ç **Energy (EN)**, **Health (HP)** –∏–ª–∏ **Gift Tokens**.
*   **–ü—Ä–∏—Ä–æ–¥–∞:** –ß–∞—Å—Ç–æ –∏–º–µ—é—Ç –º–∞–≥–∏—á–µ—Å–∫—É—é –ø—Ä–∏—Ä–æ–¥—É –∏–ª–∏ —Ç—Ä–µ–±—É—é—Ç —Å–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —É—Å–∏–ª–∏–π.
*   **–ü—Ä–∏–º–µ—Ä—ã:** *Fireball, Heal, Heavy Strike, Stone Skin.*

### 2. Feints (–§–∏–Ω—Ç—ã)
*   **–°—É—Ç—å:** –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–µ–º—ã, —É–ª–æ–≤–∫–∏, –≥—Ä—è–∑–Ω–∞—è –∏–≥—Ä–∞.
*   **–†–µ—Å—É—Ä—Å:** –¢—Ä–∞—Ç—è—Ç **Tactical Tokens** (Tempo, Advantage, Balance).
*   **–ü—Ä–∏—Ä–æ–¥–∞:** –§–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–µ –∏ —Ö–∏—Ç—Ä–æ—Å—Ç–∏.
*   **–ü—Ä–∏–º–µ—Ä—ã:** *Sand Throw (–ë—Ä–æ—Å–æ–∫ –ø–µ—Å–∫–∞), Kidney Shot (–£–¥–∞—Ä –ø–æ –ø–æ—á–∫–∞–º), Disarm (–û–±–µ–∑–æ—Ä—É–∂–∏–≤–∞–Ω–∏–µ).*

---

## ‚öôÔ∏è –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª (Execution Flow)

–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `AbilityService` –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω –±–æ—è.

### –§–∞–∑–∞ 1: Pre-Calculation (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
–î–æ —Ç–æ–≥–æ, –∫–∞–∫ –∫—É–±–∏–∫–∏ –±—Ä–æ—à–µ–Ω—ã.

1.  **Validation & Cost:**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (EN/HP –¥–ª—è –∞–±–∏–ª–æ–∫, –¢–æ–∫–µ–Ω—ã –¥–ª—è —Ñ–∏–Ω—Ç–æ–≤).
    *   –†–µ—Å—É—Ä—Å—ã **—Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è** (—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ `resource_changes`).
2.  **DTO Creation:**
    *   –°–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π `ActiveAbilityDTO`.
    *   –û–Ω –∂–∏–≤–µ—Ç —Ä–æ–≤–Ω–æ **–æ–¥–∏–Ω —Ä–∞–∑–º–µ–Ω** (–∏–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ —Ö–æ–¥–∞).
3.  **Stat Mutations (Raw):**
    *   –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`raw_mutations`).
    *   *–ü—Ä–∏–º–µ—Ä:* "+20% Fire Damage", "-50% Accuracy".
4.  **Pipeline Configuration:**
    *   –ê–±–∏–ª–∫–∞ –º–µ–Ω—è–µ—Ç —Ñ–ª–∞–≥–∏ –±–æ—è (`pipeline_mutations`).
    *   *–ü—Ä–∏–º–µ—Ä:* "–£—Ä–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –û–≥–Ω–µ–Ω–Ω—ã–º", "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ë–ª–æ–∫", "–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ö—Ä–∏—Ç".
5.  **Trigger Activation:**
    *   –í–∑–≤–æ–¥—è—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã (`triggers`).
    *   *–ü—Ä–∏–º–µ—Ä:* "–ï—Å–ª–∏ –∫—Ä–∏—Ç -> –Ω–∞–ª–æ–∂–∏—Ç—å –ì–æ—Ä–µ–Ω–∏–µ".

### –§–∞–∑–∞ 2: Calculation (Resolver)
–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ (`CombatResolver`) –ø—Ä–æ–≤–æ–¥–∏—Ç —Ä–∞—Å—á–µ—Ç –±–æ—è —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –§–∞–∑—ã 1.
–ê–±–∏–ª–∫–∞ —Å–∞–º–∞ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç —É—Ä–æ–Ω, –æ–Ω–∞ **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç** –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.

### –§–∞–∑–∞ 3: Post-Calculation (–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è)
–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω.

1.  **Cleanup:**
    *   –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º—É—Ç–∞—Ü–∏–∏ —Å—Ç–∞—Ç–æ–≤ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è.
2.  **Effect Application:**
    *   –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è (`is_hit`, `is_crit`, `is_blocked`).
    *   –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`effects`).
    *   *–ü—Ä–∏–º–µ—Ä:* –ï—Å–ª–∏ –ø–æ–ø–∞–ª -> –ù–∞–ª–æ–∂–∏—Ç—å "–Ø–¥". –ï—Å–ª–∏ –±–ª–æ–∫ -> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 10 HP.

---

## üß© –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –†–µ–∑–æ–ª–≤–µ—Ä–æ–º

–ê–±–∏–ª–∫–∏ –Ω–µ "–Ω–∞–Ω–æ—Å—è—Ç —É—Ä–æ–Ω" –Ω–∞–ø—Ä—è–º—É—é (–∫—Ä–æ–º–µ `override_damage`). –û–Ω–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞—Ä–∞.

| –ü–∞—Ä–∞–º–µ—Ç—Ä –ê–±–∏–ª–∫–∏ | –í–ª–∏—è–Ω–∏–µ –Ω–∞ –†–µ–∑–æ–ª–≤–µ—Ä |
| :--- | :--- |
| `raw_mutations` | –ò–∑–º–µ–Ω—è–µ—Ç `attacker_stats` (–°–∏–ª–∞, –¢–æ—á–Ω–æ—Å—Ç—å, –ö—Ä–∏—Ç). |
| `pipeline_mutations` | –ò–∑–º–µ–Ω—è–µ—Ç `ctx.flags` (–¢–∏–ø —É—Ä–æ–Ω–∞, –ü—Ä–æ–ø—É—Å–∫ —Ñ–∞–∑). |
| `triggers` | –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤ `ctx.triggers` (–õ–æ–≥–∏–∫–∞ "–ï—Å–ª–∏... –¢–æ..."). |
| `override_damage` | –ó–∞–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—É —É—Ä–æ–Ω–∞ –æ—Ä—É–∂–∏—è –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. |

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –õ–æ–≥–∏–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–≥–Ω–µ–Ω–Ω—ã–π –®–∞—Ä (Fireball)
1.  **Cost:** -25 EN.
2.  **Pre-Calc:**
    *   –§–ª–∞–≥ `damage.fire = True` (–£—Ä–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–≥–Ω–µ–Ω–Ω—ã–º).
    *   –§–ª–∞–≥ `damage.physical = False` (–§–∏–∑. —É—Ä–æ–Ω –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è).
    *   –ú—É—Ç–∞—Ü–∏—è `magical_damage_bonus += 20%`.
3.  **Resolver:** –°—á–∏—Ç–∞–µ—Ç —É—Ä–æ–Ω –∫–∞–∫ –º–∞–≥–∏—á–µ—Å–∫–∏–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑–∏—Å—Ç–∞ –∫ –æ–≥–Ω—é).
4.  **Post-Calc:**
    *   –ï—Å–ª–∏ `is_hit`: –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç "Burn" (DOT).

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë—Ä–æ—Å–æ–∫ –ü–µ—Å–∫–∞ (Sand Throw)
1.  **Cost:** -1 Tempo Token.
2.  **Pre-Calc:**
    *   –ú—É—Ç–∞—Ü–∏—è `physical_damage_mult = -80%` (–£—Ä–æ–Ω –ø–æ—á—Ç–∏ –Ω—É–ª–µ–≤–æ–π).
3.  **Resolver:** –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ—á–Ω–æ—Å—Ç–∏/—É–≤–æ—Ä–æ—Ç–∞.
4.  **Post-Calc:**
    *   –ï—Å–ª–∏ `is_hit`: –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç "Blind" (–°–Ω–∏–∂–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏).

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –õ–µ—á–µ–Ω–∏–µ (Heal)
1.  **Cost:** -15 EN.
2.  **Logic:** `is_attack = False`.
3.  **Post-Calc:**
    *   –°—Ä–∞–∑—É –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç "Instant Heal" (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ HP).
    *   –†–µ–∑–æ–ª–≤–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
