# üéº Combat Session Service

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Orchestrator](../README.md)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ
–§–∞—Å–∞–¥ (Facade) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π –±–æ—è. –°–∫—Ä—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å `CombatManager` –∏ `TurnManager` –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞.
–†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (`char_id`), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—è –µ–≥–æ `session_id`.

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –•–æ–¥–∞ (`register_move`)
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ `TurnManager`.
*   **Input:** `char_id`, `payload` (action, target).
*   **Process:**
    1.  –ù–∞—Ö–æ–¥–∏—Ç `session_id` —á–µ—Ä–µ–∑ `AccountManager`.
    2.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ Redis/ARQ (`TurnManager`).
    3.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π UI).

### 2. –°–±–æ—Ä–∫–∞ –°–Ω–∞–ø—à–æ—Ç–∞ (`get_snapshot`)
–°–æ–±–∏—Ä–∞–µ—Ç "–ª–µ–≥–∫–∏–π" –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (Lightweight Snapshot).
*   **Optimization:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `batched` –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ Redis.
*   **Data:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ Meta, State (HP/En) –∏ Loadout. –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç—è–∂–µ–ª—É—é –º–∞—Ç–µ–º–∞—Ç–∏–∫—É (StatsEngine).
*   **Output:** `CombatDashboardDTO` (—á–µ—Ä–µ–∑ `ViewService`).

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–º –¶–∏–∫–ª–æ–º
*   `link_players_to_session`: –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –∫ —Å–µ—Å—Å–∏–∏ –≤ Redis.
*   `unlink_players_from_session`: –û—á–∏—â–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É –ø–æ—Å–ª–µ –±–æ—è.
