# ğŸ“œ Log Builder (Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ›Ğ¾Ğ³Ğ¾Ğ²)

**Class:** `CombatLogBuilder`
**Path:** `apps.game_core.modules.combat.combat_engine.logic.log_builder`
**Type:** Stateless Logic Service

## ğŸ¯ ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
ĞŸÑ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑƒÑ…Ğ¸Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ğ¾Ñ (`CombatEventDTO`) Ğ² ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹, Ñ…ÑƒĞ´Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°.
ĞÑ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ° "Ğ½Ğ°Ñ€Ñ€Ğ°Ñ‚Ğ¸Ğ²" Ğ±Ğ¾Ñ, Ğ¿Ğ¾Ğ´Ğ±Ğ¸Ñ€Ğ°Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (ĞºÑ‚Ğ¾ ÑƒĞ´Ğ°Ñ€Ğ¸Ğ», Ñ‡ĞµĞ¼ ÑƒĞ´Ğ°Ñ€Ğ¸Ğ», ĞºĞ°ĞºĞ¾Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚).

---

## âš™ï¸ ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `CombatOrchestrator` Ğ² ĞºĞ¾Ğ½Ñ†Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ñ…Ğ¾Ğ´Ğ° (Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ).

### 1. Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
ĞĞ° Ğ²Ñ…Ğ¾Ğ´ Ğ¿Ğ¾ÑÑ‚ÑƒĞ¿Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ (`InteractionResultDTO`), ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¸Ğ· ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (`events`).

```python
events = [
    CombatEventDTO(type="CAST", source_id=1, action_id="fireball"),
    CombatEventDTO(type="HIT", source_id=1, target_id=2, value=50, tags=["CRIT"]),
    CombatEventDTO(type="APPLY_EFFECT", target_id=2, action_id="burn")
]
```

### 2. ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°
Ğ‘Ğ¸Ğ»Ğ´ĞµÑ€ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑĞºĞ°Ğ·.
*   **Chain:** CAST -> HIT -> EFFECT Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑÑÑ‚ÑÑ Ğ² Ğ¾Ğ´Ğ½Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ.
*   **Mass Attack:** Ğ•ÑĞ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ CAST Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ» Ğ¼Ğ½Ğ¾Ğ³Ğ¾ HIT (Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼ Ñ†ĞµĞ»ÑĞ¼), Ğ¾Ğ½Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒÑÑ‚ÑÑ.

### 3. Flavor Text Selection (Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ)
Ğ‘Ğ¸Ğ»Ğ´ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `GameData.flavor` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¸ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº.

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° FlavorData:**
*   **Icons:** Ğ˜ĞºĞ¾Ğ½ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ°ÑÑ‚Ğ°, Ñ…Ğ¸Ñ‚Ğ°, ĞºÑ€Ğ¸Ñ‚Ğ°.
*   **Templates:** Ğ¢ĞµĞºÑÑ‚Ñ‹, Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‰Ğ¸Ğµ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° (`source_type`) Ğ¸ Ğ¸ÑÑ…Ğ¾Ğ´Ğ° (`outcome`).

**ĞšĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾Ğ¸ÑĞºĞ°:**
1.  **Action ID:** `fireball`
2.  **Source Type:** `humanoid` / `dragon` / `undead` (ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°)
3.  **Outcome:** `hit` / `crit` / `miss` / `dodge`

*ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:*
*   `fireball.cast.humanoid`: "ĞœĞ°Ğ³ ÑˆĞµĞ¿Ñ‡ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ° ÑĞ¸Ğ»Ñ‹ Ğ¸ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ÑˆĞ°Ñ€ Ğ¾Ğ³Ğ½Ñ..."
*   `fireball.hit.crit`: "...Ğ¿Ğ»Ğ°Ğ¼Ñ Ñ€ĞµĞ²ĞµÑ‚, Ğ¸ÑĞ¿ĞµĞ¿ĞµĞ»ÑÑ Ğ²Ñ€Ğ°Ğ³Ğ°!"

### 4. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
ĞŸĞ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ¸ Ğ² ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½.
*   `{source}` -> **Gandalf**
*   `{target}` -> **Orc**
*   `{value}` -> 50
*   `{icon}` -> ğŸ”¥

---

## ğŸ“¦ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ›Ğ¾Ğ³Ğ¾Ğ²

Ğ›Ğ¾Ğ³ Ğ±Ğ¾Ñ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· **Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²** (Turn Log).

### Ğ¢Ğ¸Ğ¿Ñ‹ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

1.  **Action Log (Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ):**
    > ğŸ§™â€â™‚ï¸ **Gandalf** ĞºĞ°ÑÑ‚ÑƒĞµÑ‚ *ĞĞ³Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¨Ğ°Ñ€*!
    > ğŸ”¥ **Orc** Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ 50 ÑƒÑ€Ğ¾Ğ½Ğ° (ĞšÑ€Ğ¸Ñ‚!).
    > â˜ ï¸ **Orc** Ğ·Ğ°Ğ³Ğ¾Ñ€Ğ°ĞµÑ‚ÑÑ.

2.  **Mechanics Log (Ğ¢Ğ¸ĞºĞ¸):**
    > ğŸ©¸ **Player** Ñ‚ĞµÑ€ÑĞµÑ‚ 5 HP Ğ¾Ñ‚ *ĞšÑ€Ğ¾Ğ²Ğ¾Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ*.
    > âœ¨ **Player** Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ 10 HP.

3.  **Death Log (Ğ¡Ğ¼ĞµÑ€Ñ‚ÑŒ):**
    > ğŸ’€ **Orc** Ğ¿Ğ¾Ğ³Ğ¸Ğ±Ğ°ĞµÑ‚!

---

## ğŸ› ï¸ Integration

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² `CombatOrchestrator`.

```python
# Ğ’ ĞºĞ¾Ğ½Ñ†Ğµ Ñ…Ğ¾Ğ´Ğ°
logs = LogBuilder.build_turn_log(results)
ctx.session.history.append(logs)
```
