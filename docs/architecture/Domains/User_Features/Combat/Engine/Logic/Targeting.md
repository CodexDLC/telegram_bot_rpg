# üéØ Targeting & Context

[‚¨ÖÔ∏è –ù–∞–∑–∞–¥: Logic](./README.md)

---

## 1. üèóÔ∏è Context Builder
**Location:** `apps/game_core/modules/combat/combat_engine/logic/context_builder.py`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ `PipelineContextDTO` ‚Äî –æ–±—ä–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Ä–∞—Å—á–µ—Ç–∞ –æ–¥–Ω–æ–≥–æ —É–¥–∞—Ä–∞.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
1.  **–°–±–æ—Ä–∫–∞ –§–ª–∞–≥–æ–≤:**
    *   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `CombatMove` (–∫–∞–∫–æ–π —Å–∫–∏–ª–ª/–ø—Ä–µ–¥–º–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).
    *   –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `ActorStats` (–∫–∞–∫–∏–µ –ø–∞—Å—Å–∏–≤–∫–∏ –µ—Å—Ç—å).
    *   –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –≤ `PipelineFlags`.
2.  **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –¢—Ä–∏–≥–≥–µ—Ä–æ–≤:**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ä—É–∂–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.
    *   –ó–∞–ø–æ–ª–Ω—è–µ—Ç `ctx.triggers`.
3.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¢–∏–ø–∞ –£—Ä–æ–Ω–∞:**
    *   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏ `damage.physical`, `damage.fire` –∏ —Ç.–¥. –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ä—É–∂–∏—è –∏–ª–∏ —Å–∫–∏–ª–ª–∞.

---

## 2. üéØ Target Resolver
**Location:** `apps/game_core/modules/combat/combat_engine/logic/target_resolver.py`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–±–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è.

### –†–µ–∂–∏–º—ã –≤—ã–±–æ—Ä–∞ (Targeting Modes)
1.  **Single Target:**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∂–∏–≤ –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π `target_id`.
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–µ–ª—å –≤—Ä–∞–≥–æ–º (–µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –≤—Ä–∞–∂–¥–µ–±–Ω–æ–µ).
2.  **Self:**
    *   –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç —Ü–µ–ª—å –Ω–∞ `source_id`.
3.  **All Enemies (AOE):**
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∂–∏–≤—ã—Ö –≤—Ä–∞–≥–æ–≤ –∏–∑ `BattleContext`.
4.  **Random Enemy:**
    *   –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —Ü–µ–ª—å (–¥–ª—è —Ö–∞–æ—Ç–∏—á–Ω—ã—Ö –∞—Ç–∞–∫ –∏–ª–∏ –±–µ—Ä—Å–µ—Ä–∫–æ–≤).
5.  **Team:**
    *   –í—Å–µ —Å–æ—é–∑–Ω–∏–∫–∏ (–¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –±–∞—Ñ—Ñ–æ–≤).

### –í–∞–ª–∏–¥–∞—Ü–∏—è
*   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (–µ—Å–ª–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–µ—Ö–∞–Ω–∏–∫–∞ —Ä—è–¥–æ–≤).
*   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å "–ù–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å" –∏–ª–∏ "–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å" (Stealth).
