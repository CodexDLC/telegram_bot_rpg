# ü§ñ Menu Bot Orchestrator

‚¨ÖÔ∏è [Back to Game Menu](../../../README.md)

> **Parent:** `BaseBotOrchestrator`
> **Layer:** Presentation (Telegram)

## 1. Purpose
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–∫–æ–π –º–µ–Ω—é.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:
1.  **Standalone:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å–∞–º–æ–≥–æ –º–µ–Ω—é (Refresh, Navigation).
2.  **Component:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ UI –º–µ–Ω—é –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (Composition).

## 2. Methods

### 2.1. `get_view(char_id: int) -> MenuViewDTO` (Component Mode)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "—á–∏—Å—Ç—ã–π" –æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é (—Ç–µ–∫—Å—Ç + –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞).
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ (Inventory, Exploration) –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –≤ —Å–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã.

*   **Logic:**
    1.  –í—ã–∑—ã–≤–∞–µ—Ç `client.get_menu_view(char_id)`.
    2.  **Error Handling (Session Expired):**
        *   –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É `session_expired` (–∏–ª–∏ 404), –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–æ—Å–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `ClientSessionExpired`.
        *   –í—ã–∑—ã–≤–∞—é—â–∏–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (Inventory/Exploration) –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ –∏ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥ –≤ –õ–æ–±–±–∏.
    3.  –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `GameMenuDTO` (Data) –≤ `MenuViewDTO` (UI).
    4.  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `MenuViewDTO`.

### 2.2. `render(payload: Any) -> UnifiedViewDTO` (Standalone Mode)
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ `BaseBotOrchestrator`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –î–∏—Ä–µ–∫—Ç–æ—Ä–æ–º –∏–ª–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –º–µ–Ω—é.

*   **Logic:**
    1.  –í—ã–∑—ã–≤–∞–µ—Ç `self.get_view(char_id)`.
    2.  **Standard Check:** –í—ã–∑—ã–≤–∞–µ—Ç `self.check_and_switch_state(response)`.
        *   *–í–∞–∂–Ω–æ:* –ï—Å–ª–∏ `check_and_switch_state` –æ–±–Ω–∞—Ä—É–∂–∏—Ç –æ—à–∏–±–∫—É —Å–µ—Å—Å–∏–∏, –æ–Ω –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –î–∏—Ä–µ–∫—Ç–æ—Ä–∞ –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥ –≤ `LOBBY`.
    3.  –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `UnifiedViewDTO(menu=menu_view, content=None)`.

### 2.3. `handle_menu_action(user_id: int, action: str) -> UnifiedViewDTO`
–ú–µ—Ç–æ–¥, –≤—ã–∑—ã–≤–∞–µ–º—ã–π –•–µ–Ω–¥–ª–µ—Ä–æ–º –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏.

*   **Logic:**
    1.  –í—ã–∑—ã–≤–∞–µ—Ç `client.dispatch_action(char_id, action)`.
    2.  **Standard Check:**
        ```python
        switch_result = await self.check_and_switch_state(response)
        if switch_result:
            return switch_result
        ```
    3.  **Fallback:** –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –≤—ã–∑—ã–≤–∞–µ—Ç `self.render()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–Ω—é.
    4.  **Return:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–æ–±—ã—á–Ω–æ `UnifiedViewDTO` —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –º–µ–Ω—é –∏–ª–∏ –æ—à–∏–±–∫–æ–π).
