# 🏗️ АРХИТЕКТУРНЫЙ ОБЗОР (Pipeline)

⬅️ [Назад](../README.md) | 🏠 [Документация](../../../README.md)

**Философия:** Бой = Асинхронная система обмена намерениями (Intents).

## 1. Standard Exchange Pipeline (Размен)
Классический удар, требующий ответа противника (или таймаута).

```text
┌─────────────────────────────────────────────────────────────┐
│                     EXCHANGE PIPELINE                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [Player A] ──┬──► TURN MANAGER ──► Redis Buffer (Wait)     │
│               │                                              │
│  [Player B] ──┘                                              │
│                                                              │
│                                         ┌──────────────┐     │
│                                         │  COLLECTOR   │     │
│                                         │ (Matchmaker) │     │
│                                         └──────┬───────┘     │
│                                                │             │
│                        ┌───────────────────────┼─────────┐   │
│                        │                       │         │   │
│                        ▼                       ▼         ▼   │
│                  [AI Tasks]            [Action Queue]  [Force]│
│                        │                       │              │
│                        ▼                       ▼              │
│                  AI Processor            EXECUTOR             │
│                        │                       │              │
│                        └───────────┬───────────┘              │
│                                    ▼                          │
│                            [Combat Pipeline]                  │
│                                    │                          │
│                                    ▼                          │
│                            [State Changes]                    │
│                                    │                          │
│                                    ▼                          │
│                              Redis Commit                     │
└─────────────────────────────────────────────────────────────┘
```

## 2. Instant Skill Pipeline (Мгновенное действие)
Скилл или предмет, который применяется сразу (бафф, хил, выстрел без ответа).
Collector не ждет пары, а сразу пропускает действие.

```text
┌─────────────────────────────────────────────────────────────┐
│                  INSTANT SKILL PIPELINE                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [Player Action] ──► TURN MANAGER ──► Redis Buffer          │
│       (Instant)                                │             │
│                                                ▼             │
│                                         ┌──────────────┐     │
│                                         │  COLLECTOR   │     │
│                                         │ (Immediate)  │     │
│                                         └──────┬───────┘     │
│                                                │             │
│                                                ▼             │
│                                          [Action Queue]      │
│                                                │             │
│                                                ▼             │
│                                            EXECUTOR          │
│                                                │             │
│                                    ┌───────────┴───────────┐ │
│                                    ▼                       ▼ │
│                            [Combat Pipeline]       [State Changes]
│                               (Apply Effect)          (Cost/CD)
│                                    │                       │
│                                    └──────────┬────────────┘
│                                               ▼
│                                         Redis Commit
└─────────────────────────────────────────────────────────────┘
```
