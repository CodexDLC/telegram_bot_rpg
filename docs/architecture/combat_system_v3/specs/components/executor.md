# Component: CombatExecutor

‚¨ÖÔ∏è [–ù–∞–∑–∞–¥](../README.md) | üè† [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../../../README.md)

**File:** `apps/game_core/modules/combat/combat_engine/processors/executor.py`
**Responsibility:** Flow Control & Task Orchestration.

`CombatExecutor` ‚Äî —ç—Ç–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç "—Å—ã—Ä—ã–µ" –¥–µ–π—Å—Ç–≤–∏—è (`CombatActionDTO`) –≤ –Ω–∞–±–æ—Ä –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –ü–∞–π–ø–ª–∞–π–Ω–∞.

## 1. –õ–æ–≥–∏–∫–∞ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (Routing)

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —Å–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π (`actions`) –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### A. Exchange (–î—É—ç–ª—å)
–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –¥–≤—É—Ö –∞–∫—Ç–µ—Ä–æ–≤.
*   **–í—Ö–æ–¥:** Action —Ç–∏–ø–∞ `exchange`.
*   **–õ–æ–≥–∏–∫–∞:**
    1.  –ù–∞—Ö–æ–¥–∏—Ç Source –∏ Target.
    2.  –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –¥–ª—è Source -> Target (Main Hand, Off Hand).
    3.  –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –¥–ª—è Target -> Source (–æ—Ç–≤–µ—Ç–Ω—ã–π —É–¥–∞—Ä).
    4.  –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (`asyncio.gather`).

### B. Unidirectional (–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ)
–î–µ–π—Å—Ç–≤–∏–µ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ü–µ–ª–µ–π (Instant Skill, Item).
*   **–í—Ö–æ–¥:** Action —Ç–∏–ø–∞ `instant` –∏–ª–∏ `item`.
*   **–õ–æ–≥–∏–∫–∞:**
    1.  –ë–µ—Ä–µ—Ç —Å–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π –∏–∑ `action.move.targets` (—É–∂–µ —Ä–µ–∑–æ–ª–≤–ª–µ–Ω—ã –ö–æ–ª–ª–µ–∫—Ç–æ—Ä–æ–º).
    2.  –î–ª—è –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É Source -> Target.
    3.  –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

## 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ó–∞–¥–∞—á (Task Generation)

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, *—Å–∫–æ–ª—å–∫–æ* —Ä–∞–∑ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ü–∞–π–ø–ª–∞–π–Ω.

*   **Dual Wield:** –ï—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä –≤—Ç–æ—Ä–æ–π —Ä—É–∫–∏ -> –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Ç–æ—Ä—É—é –∑–∞–¥–∞—á—É.
*   **Multi-Hit:** –ï—Å–ª–∏ –∞–±–∏–ª–∫–∞ –±—å–µ—Ç 3 —Ä–∞–∑–∞ -> –¥–æ–±–∞–≤–ª—è–µ—Ç 3 –∑–∞–¥–∞—á–∏.
*   **AoE:** –ï—Å–ª–∏ —Ü–µ–ª–µ–π 5 -> –¥–æ–±–∞–≤–ª—è–µ—Ç 5 –∑–∞–¥–∞—á.

–ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ ‚Äî —ç—Ç–æ –≤—ã–∑–æ–≤ `CombatPipeline.execute(...)`.
