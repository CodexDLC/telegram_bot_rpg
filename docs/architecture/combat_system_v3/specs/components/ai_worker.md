# Component: AI Worker (Ghost Agent)

‚¨ÖÔ∏è [–ù–∞–∑–∞–¥](../README.md) | üè† [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../../../../README.md)

**File:** `apps/game_core/modules/combat/combat_engine/workers/tasks/ai_turn_task.py`
**Responsibility:** –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –∑–∞ NPC –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Ghost Agent ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –∑–∞ —Å—É—â–Ω–æ—Å—Ç—å (–º–æ–Ω—Å—Ç—Ä–∞ –∏–ª–∏ –∏–≥—Ä–æ–∫–∞ –≤ AFK) –≤ –±–æ—é.
–ï–≥–æ –∑–∞–¥–∞—á–∞ ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –ò–Ω—Ç–µ–Ω—Ç (Intent) –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Å–∏—Å—Ç–µ–º—É —Ç–∞–∫ –∂–µ, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –∂–∏–≤–æ–π –∏–≥—Ä–æ–∫.

## 2. –õ–æ–≥–∏–∫–∞ –ü—Ä–∏–Ω—è—Ç–∏—è –†–µ—à–µ–Ω–∏–π (Decision Logic)

### A. –ê–Ω–∞–ª–∏–∑ –†–µ—Å—É—Ä—Å–æ–≤
AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ **Tactical Tokens** —É —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
*   –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–æ–≤ < Cost —Ñ–∏–Ω—Ç–∞ -> –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ **–ë–∞–∑–æ–≤–∞—è –ê—Ç–∞–∫–∞**.
*   –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–æ–≤ >= Cost —Ñ–∏–Ω—Ç–∞ -> –î–æ—Å—Ç—É–ø–Ω—ã **–ë–∞–∑–æ–≤–∞—è –ê—Ç–∞–∫–∞** –∏ **–°–ø–µ—Ü–ø—Ä–∏–µ–º—ã (Feints)**.

### B. –í—ã–±–æ—Ä –î–µ–π—Å—Ç–≤–∏—è
–ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ (v3.1 MVP) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Random Weighted Selection**:
1.  –°–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤).
2.  –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ.
    *   *Roadmap:* –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Å–æ–≤ (Weights), —É—á–∏—Ç—ã–≤–∞—é—â–∞—è HP –≤—Ä–∞–≥–∞, –µ–≥–æ —Å—Ç–æ–π–∫—É –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.

### C. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–Ω—Ç–µ–Ω—Ç–∞
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è AI —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Intent Object, –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ç–æ–º—É, —á—Ç–æ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∏–≥—Ä–æ–∫.

```python
intent = {
    "target_id": 101,
    "action_id": "feint_heavy_smash" # –ò–ª–∏ "basic_attack"
}
```

## 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
1.  **Trigger:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ö–æ–ª–ª–µ–∫—Ç–æ—Ä–æ–º (`ai_turn_task`), –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ —É –±–æ—Ç–∞ –µ—Å—Ç—å —Ü–µ–ª–∏, –Ω–æ –Ω–µ—Ç –∑–∞—è–≤–ª–µ–Ω–Ω—ã—Ö —Ö–æ–¥–æ–≤.
2.  **Registration:** AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CombatTurnManager.register_moves_batch` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–≤–æ–∏—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π.
    *   –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ö–æ–¥—ã –±–æ—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç—É –∂–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ç—É –∂–µ –æ—á–µ—Ä–µ–¥—å `moves`, —á—Ç–æ –∏ —Ö–æ–¥—ã –∏–≥—Ä–æ–∫–æ–≤.
