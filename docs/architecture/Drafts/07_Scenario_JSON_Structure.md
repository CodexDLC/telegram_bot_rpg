# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –°—Ü–µ–Ω–∞—Ä–∏–µ–≤ (Quest Engine v2.0)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –ö–∞–∂–¥—ã–π –∫–≤–µ—Å—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º JSON-—Ñ–∞–π–ª–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–º –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏: `master` (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) –∏ `nodes` (—Å–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω).

---

## 1. –¢–∞–±–ª–∏—Ü–∞ A: ScenarioMaster (–®–∞–ø–∫–∞ –∫–≤–µ—Å—Ç–∞)

–û–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ –∏ –≤—ã—Ö–æ–¥–∞ (—ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–∞–≥—Ä–∞–¥—ã).

### –ü—Ä–∏–º–µ—Ä JSON
```json
{
  "quest_key": "awakening_rift",
  "start_node_id": "start_platform_01",
  "status_bar_fields": [
    {"key": "hp_current", "label": "‚ù§Ô∏è"},
    {"key": "step_counter", "label": "üë£"}
  ],
  "config": {
    "backup_interval": 5
  }
}
```

### –ü–æ–ª—è
*   **`quest_key`**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–≤–µ—Å—Ç–∞.
*   **`start_node_id`**: ID –ø–µ—Ä–≤–æ–π —Å—Ü–µ–Ω—ã.
*   **`status_bar_fields`**: –°–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ.
    *   `key`: –ö–ª—é—á –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–µ—Å—Å–∏–∏.
    *   `label`: Emoji –∏–ª–∏ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –∑–Ω–∞—á–µ–Ω–∏–µ–º.
*   **`config`**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–∞—Å—Ç–æ—Ç–∞ –±—ç–∫–∞–ø–æ–≤).

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (`init_sync`) –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (`export_sync`) —Ç–µ–ø–µ—Ä—å –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ Python-–∫–æ–¥ (Handlers), —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å JSON —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.

---

## 2. –¢–∞–±–ª–∏—Ü–∞ B: ScenarioNode (–ö–æ–Ω—Ç–µ–Ω—Ç)

–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ –º–∞—Å—Å–∏–≤–µ `nodes` ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ü–µ–Ω–∞ (—ç–∫—Ä–∞–Ω) —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏.

### –ü—Ä–∏–º–µ—Ä 1: –û–±—ã—á–Ω–∞—è —Å—Ü–µ–Ω–∞
```json
{
  "node_key": "start_platform_01",
  "quest_key": "awakening_rift",
  "text_content": "–ü—Ä–∏—á–∞–ª—å–Ω—ã–π –£–∑–µ–ª [52:52]. –í–æ–∫—Ä—É–≥ –ª–∏—à—å –≥—É–ª –ø–æ—Ä—Ç–∞–ª–æ–≤. –ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π –û—Ü–µ–Ω—â–∏–∫.\n\n‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–∞–±–∞—è. –ü—Ä–∏–¥–µ—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.",
  "actions_logic": {
    "next": {
      "label": "‚Äî –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?",
      "to_node": "crash_sequence_02",
      "math": { "w_wisdom": "+1" }
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –í—ã–±–æ—Ä —Å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º–∏
```json
{
  "node_key": "rift_event_fire_01",
  "quest_key": "awakening_rift",
  "text_content": "–û—Å–∫–æ–ª–æ–∫ –ø—ã–ª–∞–µ—Ç. –ü—É—Ç—å –ø—Ä–µ–≥—Ä–∞–∂–¥–∞–µ—Ç –æ–≥–Ω–µ–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞.",
  "actions_logic": {
    "power": {
      "label": "[–°–ò–õ–ê] –ü—Ä–æ–π—Ç–∏ –Ω–∞—Å–∫–≤–æ–∑—å",
      "to_node": "next_step",
      "math": { 
        "w_strength": "+2", 
        "t_fire": "+1",
        "hp": "-1d6"
      }
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –õ–æ–≥–∏—á–µ—Å–∫–∏–π –∑–∞—Ç–≤–æ—Ä (Logic Gate)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –∏–≥—Ä–æ–∫–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö.

```json
{
  "node_key": "reward_logic_04",
  "quest_key": "awakening_rift",
  "text_content": "–Ø–∫–æ—Ä—å —Ä–µ–∑–æ–Ω–∏—Ä—É–µ—Ç...",
  "actions_logic": {
    "auto": {
      "type": "logic_gate",
      "branching": [
        {
          "condition": "w_strength >= w_agility",
          "math": { "loot_queue": "push:sword_common" },
          "to_node": "rift_step_5"
        },
        {
          "condition": "default",
          "math": { "loot_queue": "push:dagger_common" },
          "to_node": "rift_step_5"
        }
      ]
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä 4: Smart Selection (–£–º–Ω—ã–π –≤—ã–±–æ—Ä)
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–æ–¥—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ –ø—É–ª–∞.

```json
{
  "node_key": "rare_event_01",
  "quest_key": "awakening_rift",
  "selection_requirements": "w_luck > 5 and has_item('lucky_coin')",
  "text_content": "–¢—ã –Ω–∞—à–µ–ª —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É!",
  "actions_logic": { ... }
}
```

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã –î–≤–∏–∂–∫–∞ (Math & Logic)

### Math (–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞)
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ø–æ–ª–µ `math`:
*   `"+1"`, `"-5"`: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç/–î–µ–∫—Ä–µ–º–µ–Ω—Ç.
*   `"=10"`: –ü—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ.
*   `"1d6"`, `"2d10"`: –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–æ–≤.
*   `"push:item_id"`: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫.
*   `"pop:item_id"`: –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.

### Director (–ù–∞–≤–∏–≥–∞—Ü–∏—è)
*   **`logic_gate`**: –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è `auto`. –î–≤–∏–∂–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –≤ `branching` —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –ø–µ—Ä–≤–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é.
*   **`pool:tag`**: –ï—Å–ª–∏ `to_node` –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pool:`, –î–∏—Ä–µ–∫—Ç–æ—Ä –∏—â–µ—Ç –≤—Å–µ –Ω–æ–¥—ã —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ç–µ–≥–æ–º –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–Ω—É —Å–ª—É—á–∞–π–Ω–æ (–∏–ª–∏ –ø–æ –≤–µ—Å—É), —É—á–∏—Ç—ã–≤–∞—è `selection_requirements`.

### Evaluator (–§—É–Ω–∫—Ü–∏–∏)
–í —É—Å–ª–æ–≤–∏—è—Ö (`condition`, `selection_requirements`) –¥–æ—Å—Ç—É–ø–Ω—ã:
*   `rand(min, max)`
*   `min(a, b)`, `max(a, b)`
*   `len(list)`
*   `has_item(id)`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ `loot_queue`.
*   `has_skill(id)`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ `skills_queue`.
