# Philosophy: Why v2?

‚¨ÖÔ∏è [–ù–∞–∑–∞–¥ –∫ Concepts](./README.md) | üè† [–ù–∞–∑–∞–¥ –∫ Context Assembler v2](../README.md)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç —ç–≤–æ–ª—é—Ü–∏—é Context Assembler –æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º—É –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—É –¥–∞–Ω–Ω—ã—Ö.

---

## –ü—Ä–æ–±–ª–µ–º–∞: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–±–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–ª v1
Context Assembler v1 –±—ã–ª —Å–æ–∑–¥–∞–Ω –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏: **–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫ –±–æ—é**.

**Workflow v1:**
1.  `CombatOrchestrator` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
2.  ‚Üí `ContextAssembler` **–í–°–ï–ì–î–ê** –∑–∞–≥—Ä—É–∂–∞–µ—Ç **–í–°–Å**
3.  ‚Üí `attributes` + `inventory` + `skills` + `vitals` + `symbiote`
4.  ‚Üí –§–æ—Ä–º–∏—Ä—É–µ—Ç **–û–î–ò–ù** `TempContextSchema`
5.  ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Redis

### –ü—Ä–æ–±–ª–µ–º—ã —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1.  **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
    *   –ï—Å–ª–∏ Status Screen –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ `attributes` –∏ `vitals`, –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º `inventory` (50+ –ø—Ä–µ–¥–º–µ—Ç–æ–≤) –∏ `skills` (30+ –∑–∞–ø–∏—Å–µ–π). –≠—Ç–æ **~70% –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö**.

2.  **–ù–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
    *   –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å (Inventory UI, Trade, Tutorial) –¥–æ–ª–∂–µ–Ω –±—ã–ª –ª–∏–±–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "—Ç—è–∂—ë–ª—ã–π" Context Assembler —Å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

3.  **Bulk-only –ø–æ–¥—Ö–æ–¥**
    *   –°–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–ª–∞ batch queries –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü. –î–∞–∂–µ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–¥–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `WHERE IN` –∏ –¥–∂–æ–π–Ω—ã –Ω–∞ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.

4.  **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π DTO**
    *   –û–¥–∏–Ω `TempContextSchema` —Å–æ –≤—Å–µ–º–∏ computed fields (`math_model`, `loadout`, `vitals`) –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –≤ –ø–∞–º—è—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–æ–ª–µ–π –Ω–µ –Ω—É–∂–Ω–∞.

### –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –±–æ–ª–∏
**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ò–≥—Ä–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (Status Screen).

**v1 –¥–µ–ª–∞–ª —Ç–∞–∫:**
*   **SQL:** 5 –∑–∞–ø—Ä–æ—Å–æ–≤ (`characters`, `attributes`, `inventory`, `skills`, `symbiote`)
*   **Redis:** 1 –∑–∞–ø—Ä–æ—Å (`vitals`)
*   **–ó–∞–≥—Ä—É–∂–µ–Ω–æ:** ~200 —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö
*   **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:** ~40 —Å—Ç—Ä–æ–∫ (—Ç–æ–ª—å–∫–æ attributes –∏ vitals)
*   **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å:** **80%**

**–ü—Ä–æ–±–ª–µ–º–∞ —É—Å—É–≥—É–±–ª—è–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–æ–º:**
*   100 –∏–≥—Ä–æ–∫–æ–≤ –æ—Ç–∫—Ä—ã–ª–∏ Status Screen –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
*   500 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (5 √ó 100)
*   20000 —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–æ
*   4000 —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
*   **16000 —Å—Ç—Ä–æ–∫ –≤—ã–±—Ä–æ—à–µ–Ω–æ**

---

## –†–µ—à–µ–Ω–∏–µ: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä

### –ù–æ–≤–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è v2
Context Assembler v2 ‚Äî —ç—Ç–æ –Ω–µ "—Å–µ—Ä–≤–∏—Å –¥–ª—è –±–æ—è", –∞ **"—Å–µ—Ä–≤–∏—Å —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª—é–±–æ–≥–æ —Å–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"**.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

#### 1. –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å = –æ–¥–Ω–∞ —Ü–µ–ª—å
–í–º–µ—Å—Ç–æ "–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π" –º—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ–º: **"–î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ?"**
–û—Ç–≤–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `scope`:
*   –î–ª—è –±–æ—è? `scope="combats"`
*   –î–ª—è —ç–∫—Ä–∞–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞? `scope="status"`
*   –î–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è? `scope="inventory"`

#### 2. Scope –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Å—ë
–û–¥–∏–Ω —Ñ–ª–∞–≥ `scope` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç:
1.  –ö–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã —á–∏—Ç–∞—Ç—å (**Query Plan**)
2.  –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—Ç—å (**Data Selection**)
3.  –ö–∞–∫–æ–π DTO —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å (**Temp Context Type**)

–≠—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: *"–°–∫–∞–∂–∏ –ß–¢–û —Ç–µ–±–µ –Ω—É–∂–Ω–æ, –Ω–µ –≥–æ–≤–æ—Ä–∏ –ö–ê–ö —ç—Ç–æ –ø–æ–ª—É—á–∏—Ç—å"*.

#### 3. Conditional Loading
–í–º–µ—Å—Ç–æ "–≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å—ë" –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ.

**–ü—Ä–∏–º–µ—Ä:**
*   `scope=status` ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º: `attributes`, `vitals`, `symbiote`
*   `scope=combats` ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º: `attributes`, `inventory(equipped)`, `skills`, `vitals`, `symbiote`
*   `scope=inventory` ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º: `inventory(all)`, `wallet`

#### 4. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
–í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ `TempContextSchema` —Ç–µ–ø–µ—Ä—å –∏–µ—Ä–∞—Ä—Ö–∏—è:
*   `BaseTempContext` ‚Äî –æ–±—â–∏–µ –ø–æ–ª—è (meta, timestamp)
    *   ‚Üì
    *   `CombatTempContext` ‚Äî computed fields –¥–ª—è –±–æ—è (`math_model`, `loadout`)
    *   `StatusTempContext` ‚Äî computed fields –¥–ª—è UI (`stats_display`, `vitals_display`)
    *   `InventoryTempContext` ‚Äî computed fields –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (`items_by_slot`, `wallet_display`)

–ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –µ–≥–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é.

---

## v2 Principles: Core vs Projections

–í–∞–∂–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã v2:

1.  **Temp Context —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏**
    *   –í Redis —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã `@computed_field` –º–µ—Ç–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `math_model`, `stats_display`).
    *   –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —á–∏—Å—Ç—ã–π JSON, –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.

2.  **Core Fields ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
    *   –ü–æ–ª—è `core_attributes`, `core_inventory` –∏ –¥—Ä—É–≥–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **—Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ Python** –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Assembler'–∞.
    *   –û–Ω–∏ –Ω—É–∂–Ω—ã –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ü–∏–π.
    *   **–í Redis –æ–Ω–∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `exclude` –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏).

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (Combat System, UI) –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î, –∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —á–∏—Å—Ç—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –ø—Ä–æ–µ–∫—Ü–∏–π.

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ v1 vs v2
**–°—Ü–µ–Ω–∞—Ä–∏–π:** Status Screen (100 –∏–≥—Ä–æ–∫–æ–≤)

**v1:**
*   500 SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (5 —Ç–∞–±–ª–∏—Ü √ó 100)
*   20000 —Å—Ç—Ä–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
*   4000 —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
*   **–í—Ä–µ–º—è: ~2.5s**

**v2 (scope=status):**
*   300 SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (3 —Ç–∞–±–ª–∏—Ü—ã √ó 100)
*   4000 —Å—Ç—Ä–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
*   4000 —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
*   **–í—Ä–µ–º—è: ~1.2s**

**–í—ã–∏–≥—Ä—ã—à:**
*   SQL –∑–∞–ø—Ä–æ—Å–æ–≤: **-40%**
*   –î–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–æ: **-80%**
*   –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: **-52%**

### –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
*   **v1:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π use case = –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–ª–∏ —Ç–∞—â–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å
*   **v2:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π use case = —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π scope

1.  –û–ø–∏—Å–∞—Ç—å scope –≤ Query Plan Builder
2.  –°–æ–∑–¥–∞—Ç—å Temp DTO (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π)
3.  –ì–æ—Ç–æ–≤–æ

**–ü—Ä–∏–º–µ—Ä: –ù—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Trade System**
**v2:**
```python
# 1. –î–æ–±–∞–≤–ª—è–µ–º scope
"trade": ["attributes", "inventory", "wallet"]

# 2. –°–æ–∑–¥–∞—ë–º DTO (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º InventoryTempContext)
class TradeTempContext(BaseTempContext):
    @computed_field
    def tradeable_items(self): ...

# 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º
request = ContextRequestDTO(player_ids=[101], scope="trade")
```

---

## –§–∏–ª–æ—Å–æ—Ñ–∏—è –≤ –∫–æ–¥–µ

**v1 –¥—É–º–∞–ª —Ç–∞–∫:**
> "–Ø —Å–µ—Ä–≤–∏—Å –¥–ª—è –±–æ—è. –Ø –∑–Ω–∞—é, —á—Ç–æ –±–æ—è –Ω—É–∂–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ. –Ø –∏—Ö –∑–∞–≥—Ä—É–∂—É."

**v2 –¥—É–º–∞–µ—Ç —Ç–∞–∫:**
> "–Ø –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö. –°–∫–∞–∂–∏ –º–Ω–µ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ (scope), –∏ —è –∑–∞–≥—Ä—É–∂—É —Ç–æ–ª—å–∫–æ —ç—Ç–æ. –Ø –Ω–µ –∑–Ω–∞—é, –¥–ª—è —á–µ–≥–æ —Ç–µ–±–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —ç—Ç–æ —Ç–≤–æ—è –∑–∞–±–æ—Ç–∞."

### –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
**v1 –Ω–∞—Ä—É—à–∞–ª SRP:**
*   –ó–Ω–∞–ª –ø—Ä–æ –±–æ–π (–∑–∞—á–µ–º –¥–∞–Ω–Ω—ã–µ)
*   –ó–∞–≥—Ä—É–∂–∞–ª –¥–∞–Ω–Ω—ã–µ (–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å)
*   –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ (–∫–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å)

**v2 —Å–æ–±–ª—é–¥–∞–µ—Ç SRP:**
*   **Orchestrator:** –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å
*   **Assembler:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
*   **Temp DTO:** –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
*   **Consumer (Combat/Status/etc):** –ó–Ω–∞–µ—Ç, –∑–∞—á–µ–º –¥–∞–Ω–Ω—ã–µ

---

## –¶–µ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ß—Ç–æ –ø—Ä–∏—à–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å
1.  **API –∫–æ–Ω—Ç—Ä–∞–∫—Ç**
    *   –î–æ–±–∞–≤–∏–ª–∏ `scope` –≤ `ContextRequestDTO`
2.  **Assemblers**
    *   –î–æ–±–∞–≤–∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `scope` –≤ `process_batch`
3.  **Query Plan Builder**
    *   –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ `scope` ‚Üí `tables`
4.  **Temp DTO**
    *   –°–æ–∑–¥–∞–ª–∏ –∏–µ—Ä–∞—Ä—Ö–∏—é –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞

### –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
1.  **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π**
    *   `CoreRouter.route("context_assembler", "assemble", {...})` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
2.  **Redis —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
    *   –í—Å—ë —Ç–∞–∫ –∂–µ `temp:setup:{uuid}`
3.  **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–±–æ—Ä–∫–∏**
    *   `PlayerAssembler` –∏ `MonsterAssembler` –æ—Å—Ç–∞–ª–∏—Å—å
4.  **Batch –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
    *   `WHERE IN` –∏ `asyncio.gather` –Ω–∏–∫—É–¥–∞ –Ω–µ –¥–µ–ª–∏—Å—å

---

## –ò—Ç–æ–≥

**v2 ‚Äî —ç—Ç–æ –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ —Ä–∞–¥–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è.**
–≠—Ç–æ —ç–≤–æ–ª—é—Ü–∏—è –æ—Ç "—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞" –∫ "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ".

*   –ú—ã –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å v1 –¥–ª—è –±–æ—è. –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤.
*   **Combat System** –ø–æ–ª—É—á–∏–ª `scope=combats` –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ (–¥–∞–∂–µ –±—ã—Å—Ç—Ä–µ–µ).
*   **Status Screen** –ø–æ–ª—É—á–∏–ª `scope=status` –∏ –ø–µ—Ä–µ—Å—Ç–∞–ª –∑–∞–≥—Ä—É–∂–∞—Ç—å –ª–∏—à–Ω–µ–µ.
*   **Inventory UI** –ø–æ–ª—É—á–∏–ª `scope=inventory` –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.
*   –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ, –Ω–µ –¥—É–º–∞—è –æ –¥–µ—Ç–∞–ª—è—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–≠—Ç–æ –∏ –µ—Å—Ç—å —Ü–µ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: **—Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º, –∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º.**
