# Integration Testing Specifications

## üîó –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–≤—è–∑–∫—É `Orchestrator` -> `Assembler` -> `Redis`. –ú—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π Redis (–º–æ–∫–∞–µ–º `aioredis`), –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º Redis (pipeline, error handling).

## üîÑ Flows

### 1. Combat Flow (P0)
**–§–∞–π–ª:** `tests/integration/context_assembler/test_combat_flow.py`

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –±–æ—è.

**–®–∞–≥–∏ —Ç–µ—Å—Ç–∞:**
1.  –í—ã–∑–æ–≤ `Orchestrator.get_entry_point` —Å `scope="combats"`.
2.  –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—ã–∑–≤–∞–Ω—ã –æ–±–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–∞ (Player –∏ Monster).
3.  –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Redis —á–µ—Ä–µ–∑ pipeline.
4.  **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —É—Ö–æ–¥—è—â–µ–π –≤ Redis (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `core_` –ø–æ–ª–µ–π, –Ω–∞–ª–∏—á–∏–µ `math_model`).

### 2. Error Handling & Resilience (P0)
**–§–∞–π–ª:** `tests/integration/context_assembler/test_error_handling.py`

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
*   **Partial Redis Failure:**
    *   –ú–æ–∫–∏—Ä—É–µ–º `pipeline.execute` —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏–∑ –∫–ª—é—á–µ–π.
    *   –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Orchestrator –≤–µ—Ä–Ω—É–ª —ç—Ç–æ—Ç ID –≤ —Å–ø–∏—Å–∫–µ `errors`, –∞ —É—Å–ø–µ—à–Ω—ã–µ ‚Äî –≤ `success`.
*   **Catastrophic Failure:**
    *   –ú–æ–∫–∏—Ä—É–µ–º –ø–∞–¥–µ–Ω–∏–µ Redis —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
    *   –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫.

### 3. Status Flow
**–§–∞–π–ª:** `tests/integration/context_assembler/test_status_flow.py`

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ (—Ç–æ–ª—å–∫–æ vitals + attributes).
*   –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Inventory Repo –ù–ï –≤—ã–∑—ã–≤–∞–ª—Å—è (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è).

## üìù Checklist

*   [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `pytest-asyncio`.
*   [ ] Redis pipeline –º–æ–∫–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤).
*   [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è (—á–µ—Ä–µ–∑ `caplog`) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö.