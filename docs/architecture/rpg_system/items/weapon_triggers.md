# Weapon Triggers System (–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –æ—Ä—É–∂–∏—è)

## üìã –û–±–∑–æ—Ä

–¢—Ä–∏–≥–≥–µ—Ä—ã ‚Äî —ç—Ç–æ —É—Å–ª–æ–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –≤–æ –≤—Ä–µ–º—è –±–æ—è –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–∫—Ä–∏—Ç, –ø–æ–ø–∞–¥–∞–Ω–∏–µ, –ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ).

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** –û—Ä—É–∂–∏–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±–æ–π –Ω–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —É—Ä–æ–Ω, –Ω–æ –∏ —á–µ—Ä–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏.

---

## üéØ –§–∏–ª–æ—Å–æ—Ñ–∏—è —Å–∏—Å—Ç–µ–º—ã

### 1. –¢—Ä–∏–≥–≥–µ—Ä—ã ‚â† –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- –¢—Ä–∏–≥–≥–µ—Ä **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞** ‚Äî —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏—è
- –¢—Ä–∏–≥–≥–µ—Ä **–ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ—Ä—É–∂–∏—é** ‚Äî –º–µ–Ω—è–µ—à—å –º–µ—á –Ω–∞ —Ç–æ–ø–æ—Ä ‚Üí –º–µ–Ω—è–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∫–∞

### 2. –¢—Ä–∏–≥–≥–µ—Ä—ã ‚Äî —á–∞—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –æ—Ä—É–∂–∏—è
- **–ú–µ—á–∏ (Swords):** –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ (Bleed) ‚Äî DoT —ç—Ñ—Ñ–µ–∫—Ç
- **–õ—É–∫–∏ (Archery):** –£–≤–æ—Ä–æ—Ç –ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞ (Hit & Run)
- **–ë—É–ª–∞–≤—ã (Macing):** –û–≥–ª—É—à–µ–Ω–∏–µ (Stun) ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å
- **–†–∞–ø–∏—Ä—ã (Fencing):** –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–æ–Ω–∏ (Armor Bypass)

### 3. –¢–æ–ª—å–∫–æ —É –æ—Ä—É–∂–∏—è
- **–ë—Ä–æ–Ω—è, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã** ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –ù–ï –∏–º–µ—é—Ç
- **–©–∏—Ç—ã** ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ **—Å–∫–∏–ª–ª—ã** (–ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ), –∞ –Ω–µ —á–µ—Ä–µ–∑ –ø—Ä–µ–¥–º–µ—Ç

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä—ã?

```
1. BaseItemDTO (–±–∞–∑–∞ –æ—Ä—É–∂–∏—è)
   ‚îú‚îÄ triggers: ["trigger_bleed"]  ‚Üê –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä —Ç–∏–ø–∞ –æ—Ä—É–∂–∏—è
   
2. Affixes (–∞—Ñ—Ñ–∏–∫—Å—ã/–∑–∞—Ç–æ—á–∫–∞)
   ‚îú‚îÄ bonuses: {"trigger_vampirism": True}  ‚Üê –ú–∞–≥–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä
   
3. WeaponData (–∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç)
   ‚îú‚îÄ triggers: ["trigger_bleed"]           ‚Üê –û—Ç –±–∞–∑—ã
   ‚îî‚îÄ bonuses: {"trigger_vampirism": True}  ‚Üê –û—Ç –∞—Ñ—Ñ–∏–∫—Å–∞
```

### –ö–∞–∫ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–æ–π?

```
ItemAssembler
    ‚Üì
WeaponData.triggers = ["trigger_bleed"]
WeaponData.bonuses = {"trigger_vampirism": True}
    ‚Üì
ContextAssembler (–ø–µ—Ä–µ–¥ –±–æ–µ–º)
    ‚Üì
Redis v:raw (–±–æ–µ–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)
    ‚Üì
ContextBuilder (–≤ –º–æ–º–µ–Ω—Ç –∞—Ç–∞–∫–∏)
    ‚Üì
ctx.triggers.trigger_bleed = True
ctx.triggers.trigger_vampirism = True
    ‚Üì
CombatResolver (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π)
    ‚Üì
if ctx.triggers.trigger_bleed and event == "ON_CRIT":
    apply_bleed_effect(target)
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ TriggerRegistry

### –§–æ—Ä–º–∞—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞

```python
TRIGGER_REGISTRY = {
    "trigger_bleed": {
        "event": "ON_CRIT",           # –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
        "chance": 1.0,                 # –®–∞–Ω—Å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (1.0 = 100%)
        "effect": "apply_bleed",       # –ß—Ç–æ –¥–µ–ª–∞–µ—Ç
        "metadata": {                  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ñ—Ñ–µ–∫—Ç–∞
            "damage_per_turn": 5,
            "duration": 3,
            "stack_limit": 3
        }
    },
    
    "trigger_vampirism": {
        "event": "ON_HIT",
        "chance": 1.0,
        "effect": "heal_attacker",
        "metadata": {
            "heal_percent": 0.15       # 15% –æ—Ç —É—Ä–æ–Ω–∞
        }
    },
    
    "trigger_armor_breach": {
        "event": "ON_CRIT",
        "chance": 1.0,
        "effect": "ignore_armor",
        "metadata": {
            "armor_ignored_percent": 1.0  # 100%
        }
    }
}
```

### –°–æ–±—ã—Ç–∏—è (Events)

| Event        | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
|--------------|--------------------------------------------|
| `ON_HIT`     | –ü—Ä–∏ –ª—é–±–æ–º –ø–æ–ø–∞–¥–∞–Ω–∏–∏                        |
| `ON_CRIT`    | –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º —É–¥–∞—Ä–µ                      |
| `ON_MISS`    | –ü—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ                                |
| `ON_PARRY`   | –ü—Ä–∏ –ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ (–∑–∞—â–∏—Ç–Ω–∏–∫ –ø–∞—Ä–∏—Ä–æ–≤–∞–ª –∞—Ç–∞–∫—É) |
| `ON_DODGE`   | –ü—Ä–∏ —É–≤–æ—Ä–æ—Ç–∞—Ö (—Ü–µ–ª—å —É–≤–µ—Ä–Ω—É–ª–∞—Å—å)             |
| `ON_KILL`    | –ü—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –≤—Ä–∞–≥–∞                         |

---

## ‚öîÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ä—É–∂–∏—è –∏ –∏—Ö —Ç—Ä–∏–≥–≥–µ—Ä—ã

### 1. Swords (–ú–µ—á–∏) ‚Äî Bleed
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –†–µ–∂—É—â–∏–µ —Ä–∞–Ω—ã ‚Üí –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä—ã:**
- **Longsword:** `trigger_bleed` (DoT)
- **Katana:** `trigger_heavy_bleed` (—É—Å–∏–ª–µ–Ω–Ω—ã–π DoT)
- **Flamberge:** `trigger_extended_bleed` (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +1)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
"trigger_bleed": {
    "event": "ON_CRIT",
    "effect": "apply_bleed",
    "metadata": {
        "damage_per_turn": 5,
        "duration": 3
    }
}
```

---

### 2. Archery (–°—Ç—Ä–µ–ª–∫–æ–≤–æ–µ) ‚Äî Tactical
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –î–∏—Å—Ç–∞–Ω—Ü–∏—è + –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å.

**–ü—Ä–∏–º–µ—Ä—ã:**
- **Shortbow:** `trigger_evasive_shot` (–±–∞—Ñ—Ñ —É–≤–æ—Ä–æ—Ç–∞ –ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞)
- **Longbow:** `trigger_sniper_crit` (–∫—Ä–∏—Ç x3 –≤–º–µ—Å—Ç–æ x2)
- **Heavy Crossbow:** `trigger_armor_pierce` (–∏–≥–Ω–æ—Ä –±—Ä–æ–Ω–∏)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
"trigger_evasive_shot": {
    "event": "ON_HIT",
    "effect": "buff_dodge",
    "metadata": {
        "dodge_tokens": 2,
        "duration": 1
    }
}

"trigger_sniper_crit": {
    "event": "ON_CRIT",
    "effect": "multiply_damage",
    "metadata": {
        "multiplier": 3.0
    }
}
```

---

### 3. Macing (–î—Ä–æ–±—è—â–µ–µ) ‚Äî Control
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –ö–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è ‚Üí –æ–≥–ª—É—à–µ–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä—ã:**
- **Mace:** `trigger_macing_stun` (–æ–≥–ª—É—à–µ–Ω–∏–µ –Ω–∞ 1 —Ö–æ–¥)
- **War Hammer:** `trigger_armor_crush` (—Å–Ω–∏–∂–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ –±–æ—è)
- **Flail:** `trigger_shield_bypass` (–∏–≥–Ω–æ—Ä –±–ª–æ–∫–∞ —â–∏—Ç–æ–º)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
"trigger_macing_stun": {
    "event": "ON_CRIT",
    "effect": "apply_stun",
    "metadata": {
        "duration": 1
    }
}

"trigger_armor_crush": {
    "event": "ON_CRIT",
    "effect": "reduce_armor",
    "metadata": {
        "armor_reduction": 0.5,  # -50% flat armor
        "duration": 99           # –î–æ –∫–æ–Ω—Ü–∞ –±–æ—è
    }
}
```

---

### 4. Fencing (–§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ) ‚Äî Precision
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –¢–æ—á–Ω–æ—Å—Ç—å + –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã.

**–ü—Ä–∏–º–µ—Ä—ã:**
- **Rapier:** `trigger_vitals_trace` (–∏–≥–Ω–æ—Ä % —Ä–µ–∑–∏—Å—Ç–∞)
- **Stiletto:** `trigger_needle_point` (–∏–≥–Ω–æ—Ä flat armor)
- **Dagger (Off-hand):** `trigger_blade_catcher` (–∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞ –ø–æ—Å–ª–µ –ø–∞—Ä–∏—Ä–æ–≤–∞–Ω–∏—è)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
"trigger_vitals_trace": {
    "event": "ON_CRIT",
    "effect": "ignore_resistance",
    "metadata": {
        "resistance_ignored_percent": 1.0
    }
}

"trigger_blade_catcher": {
    "event": "ON_PARRY",
    "effect": "grant_counter_token",
    "metadata": {
        "counter_tokens": 1
    }
}
```

---

### 5. Polearms (–î—Ä–µ–≤–∫–æ–≤–æ–µ) ‚Äî Distance Control
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** –î–ª–∏–Ω–∞ –æ—Ä—É–∂–∏—è ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**
- **Pike:** `trigger_piercing_thrust` (–∏–≥–Ω–æ—Ä —Ä–µ–∑–∏—Å—Ç–∞)
- **Halberd:** `trigger_armor_crush` (—Å–Ω–∏–∂–µ–Ω–∏–µ –±—Ä–æ–Ω–∏)
- **Trident:** `trigger_entangle` (Root, –æ–±–µ–∑–¥–≤–∏–∂–∏–≤–∞–Ω–∏–µ)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
"trigger_piercing_thrust": {
    "event": "ON_CRIT",
    "effect": "ignore_resistance",
    "metadata": {
        "resistance_ignored_percent": 1.0
    }
}

"trigger_entangle": {
    "event": "ON_HIT",
    "chance": 0.3,  # 30% —à–∞–Ω—Å
    "effect": "apply_root",
    "metadata": {
        "duration": 1
    }
}
```

---

## üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (game_data/triggers/)

```python
# apps/game_core/resources/game_data/triggers/definitions/weapon_triggers.py

from apps.game_core.resources.game_data.triggers.schemas import TriggerData

WEAPON_TRIGGERS: dict[str, TriggerData] = {
    "trigger_bleed": TriggerData(
        id="trigger_bleed",
        name_ru="–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ",
        event="ON_CRIT",
        chance=1.0,
        effect="apply_bleed",
        metadata={
            "damage_per_turn": 5,
            "duration": 3,
            "stack_limit": 3
        }
    ),
    
    "trigger_vampirism": TriggerData(
        id="trigger_vampirism",
        name_ru="–í–∞–º–ø–∏—Ä–∏–∑–º",
        event="ON_HIT",
        chance=1.0,
        effect="heal_attacker",
        metadata={
            "heal_percent": 0.15
        }
    ),
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
}
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –±–∞–∑–µ –æ—Ä—É–∂–∏—è (base_item/weapons/)

```python
# apps/game_core/resources/game_data/items/base_item/weapons/swords.py

from apps.game_core.resources.game_data.items.schemas import BaseItemDTO

SWORDS_DB = {
    "longsword": BaseItemDTO(
        id="longsword",
        name_ru="–î–ª–∏–Ω–Ω—ã–π –º–µ—á",
        slot="main_hand",
        type="weapon",
        
        base_power=10,
        base_durability=100,
        damage_spread=0.2,
        
        allowed_materials=["ingots"],
        
        triggers=["trigger_bleed"],  # ‚Üê –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä
        
        narrative_tags=["blade", "versatile"]
    ),
    
    "katana": BaseItemDTO(
        id="katana",
        name_ru="–ö–∞—Ç–∞–Ω–∞",
        slot="main_hand",
        type="weapon",
        
        base_power=12,
        base_durability=80,
        damage_spread=0.15,
        
        allowed_materials=["ingots"],
        
        triggers=["trigger_heavy_bleed"],  # ‚Üê –£—Å–∏–ª–µ–Ω–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä
        
        narrative_tags=["blade", "precise", "exotic"]
    )
}
```

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –±–æ—é (combat/logic/combat_resolver.py)

```python
# apps/game_core/modules/combat/combat_engine/logic/combat_resolver.py

async def resolve_attack(ctx: ActionContext) -> ResolveResult:
    """
    –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∞—Ç–∞–∫–∏ —Å —É—á—ë—Ç–æ–º —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.
    """
    # 1. –†–∞—Å—á—ë—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è/—É–≤–æ—Ä–æ—Ç–æ–≤
    hit_roll = random.random()
    if hit_roll > ctx.attacker.accuracy:
        return ResolveResult(outcome="miss")
    
    # 2. –†–∞—Å—á—ë—Ç —É—Ä–æ–Ω–∞
    damage = calculate_damage(ctx)
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∞
    is_crit = random.random() < ctx.attacker.crit_chance
    if is_crit:
        damage *= ctx.attacker.crit_power
    
    # 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
    mutations = []
    
    # ON_HIT —Ç—Ä–∏–≥–≥–µ—Ä—ã (–≤—Å–µ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏)
    for trigger_id in ctx.attacker.triggers:
        trigger = WEAPON_TRIGGERS.get(trigger_id)
        if not trigger:
            continue
        
        if trigger.event == "ON_HIT":
            if random.random() <= trigger.chance:
                effect = apply_trigger_effect(trigger, ctx)
                mutations.append(effect)
    
    # ON_CRIT —Ç—Ä–∏–≥–≥–µ—Ä—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫—Ä–∏—Ç–µ)
    if is_crit:
        for trigger_id in ctx.attacker.triggers:
            trigger = WEAPON_TRIGGERS.get(trigger_id)
            if not trigger:
                continue
            
            if trigger.event == "ON_CRIT":
                if random.random() <= trigger.chance:
                    effect = apply_trigger_effect(trigger, ctx)
                    mutations.append(effect)
    
    # 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º—É—Ç–∞—Ü–∏–π
    for mutation in mutations:
        await apply_mutation(ctx, mutation)
    
    return ResolveResult(
        outcome="hit" if not is_crit else "crit",
        damage=damage,
        mutations=mutations
    )


def apply_trigger_effect(trigger: TriggerData, ctx: ActionContext) -> Mutation:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –≤ –º—É—Ç–∞—Ü–∏—é (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è).
    """
    effect_type = trigger.effect
    metadata = trigger.metadata
    
    if effect_type == "apply_bleed":
        return Mutation(
            type="add_status_effect",
            target=ctx.defender.actor_id,
            data={
                "effect_id": "bleed",
                "damage_per_turn": metadata["damage_per_turn"],
                "duration": metadata["duration"]
            }
        )
    
    elif effect_type == "heal_attacker":
        heal_amount = int(ctx.final_damage * metadata["heal_percent"])
        return Mutation(
            type="heal",
            target=ctx.attacker.actor_id,
            data={"amount": heal_amount}
        )
    
    elif effect_type == "ignore_armor":
        return Mutation(
            type="modify_defense",
            target=ctx.defender.actor_id,
            data={
                "flat_armor_multiplier": 0.0,  # –ë—Ä–æ–Ω—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
                "duration": "this_attack"
            }
        )
    
    # ... –¥—Ä—É–≥–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
    
    return Mutation(type="none")
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ú–µ—á —Å –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ–º

```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
weapon = ItemAssembler.assemble_equipment(
    base_id="longsword",
    target_tier=2,
    bundle_id=None
)

# WeaponData
{
    "power": 15.0,
    "spread": 0.2,
    "triggers": ["trigger_bleed"],  # ‚Üê –û—Ç –±–∞–∑—ã
    "bonuses": {}
}

# –í –±–æ—é
# 1. –ê—Ç–∞–∫–∞ –∫—Ä–∏—Ç—É–µ—Ç
# 2. CombatResolver –ø—Ä–æ–≤–µ—Ä—è–µ—Ç ctx.triggers.trigger_bleed
# 3. trigger_bleed.event == "ON_CRIT" ‚Üí —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
# 4. –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç Bleed –Ω–∞ 3 —Ö–æ–¥–∞
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–µ—á —Å –≤–∞–º–ø–∏—Ä–∏–∑–º–æ–º (–∞—Ñ—Ñ–∏–∫—Å)

```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å –∞—Ñ—Ñ–∏–∫—Å–æ–º
weapon = ItemAssembler.assemble_equipment(
    base_id="longsword",
    target_tier=3,
    bundle_id="vampirism"  # ‚Üê –ê—Ñ—Ñ–∏–∫—Å
)

# WeaponData
{
    "power": 20.0,
    "spread": 0.2,
    "triggers": ["trigger_bleed"],              # ‚Üê –û—Ç –±–∞–∑—ã
    "bonuses": {"trigger_vampirism": True}      # ‚Üê –û—Ç –∞—Ñ—Ñ–∏–∫—Å–∞
}

# –í –±–æ—é
# 1. –ê—Ç–∞–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç
# 2. CombatResolver –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞
# 3. trigger_vampirism (ON_HIT) ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç HP
# 4. –ï—Å–ª–∏ –∫—Ä–∏—Ç ‚Üí trigger_bleed ‚Üí –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ
```

### –ü—Ä–∏–º–µ—Ä 3: –¢—è–∂—ë–ª—ã–π –∞—Ä–±–∞–ª–µ—Ç (–ø—Ä–æ–±–∏—Ç–∏–µ –±—Ä–æ–Ω–∏)

```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
weapon = ItemAssembler.assemble_equipment(
    base_id="heavy_crossbow",
    target_tier=4,
    bundle_id=None
)

# WeaponData
{
    "power": 30.0,
    "spread": 0.1,
    "triggers": ["trigger_armor_pierce"],  # ‚Üê –û—Ç –±–∞–∑—ã
    "bonuses": {}
}

# –í –±–æ—é
# 1. –ê—Ç–∞–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç (ON_HIT)
# 2. trigger_armor_pierce ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç 100% flat armor
# 3. –£—Ä–æ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å –±—Ä–æ–Ω—é
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–î–∏–∑–∞–π–Ω —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø–∞–º –æ—Ä—É–∂–∏—è:**
  - [archery.md](./archery.md) ‚Äî –°—Ç—Ä–µ–ª–∫–æ–≤–æ–µ
  - [fencing.md](./fencing.md) ‚Äî –§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ
  - [swords.md](./swords.md) ‚Äî –ú–µ—á–∏
  - [macing.md](./macing.md) ‚Äî –î—Ä–æ–±—è—â–µ–µ
  - [polearms.md](./polearms.md) ‚Äî –î—Ä–µ–≤–∫–æ–≤–æ–µ

- **–°–∏—Å—Ç–µ–º–∞ –±–æ—è:** `/docs/architecture/combat_system_v3/`
- **–ü—Ä–µ–¥–º–µ—Ç—ã:** `/docs/rpg_system/items/README.md`

---

## üöß TODO

- [ ] –°–æ–∑–¥–∞—Ç—å `TriggerData` —Å—Ö–µ–º—É (Pydantic DTO)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `apply_trigger_effect()` –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `.md` —Ñ–∞–π–ª–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å UI-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –≤ –±–æ—é

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –Ø–Ω–≤–∞—Ä—å 2026  
**–°—Ç–∞—Ç—É—Å:** Draft (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞)
