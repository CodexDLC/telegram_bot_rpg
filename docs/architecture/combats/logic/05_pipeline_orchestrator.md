# Pipeline Orchestrator Specification (RBC v3.1)

**Role:** Logic Core.
**Responsibility:** –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π (Intents) –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (State Changes).

---

## üìë –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ü–∞–π–ø–ª–∞–π–Ω–∞ RBC v3.0

–ü–∞–π–ø–ª–∞–π–Ω ‚Äî —ç—Ç–æ –∂–µ—Å—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–¥–∏–π, –≥–¥–µ –∫–∞–∂–¥–∞—è –ø–æ—Å–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–¥–∏—è –¥–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–º, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π.

### –°—Ç–∞–¥–∏—è 0: –•–µ–ª–ø–µ—Ä-–°–±–æ—Ä—â–∏–∫ (Context Builder)
–≠—Ç–æ –≤—Ö–æ–¥–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä. –û–Ω –Ω–µ —Å—á–∏—Ç–∞–µ—Ç —É—Ä–æ–Ω, –æ–Ω ¬´–Ω–∞—Ä–µ–∑–∞–µ—Ç –∑–∞–¥–∞—á–∏¬ª.

*   **–í—Ö–æ–¥:** `CombatMoveDTO` (—Ç–æ, —á—Ç–æ –ø—Ä–∏—Å–ª–∞–ª –∫–ª–∏–µ–Ω—Ç: `intent_id` –∏ `selected_parameters`).
*   **–õ–æ–≥–∏–∫–∞:** –•–µ–ª–ø–µ—Ä –ª–µ–∑–µ—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏–Ω—Ç–µ–Ω—Ç–æ–≤. –û–Ω –≤–∏–¥–∏—Ç: ¬´–ê–≥–∞, –ò–Ω—Ç–µ–Ω—Ç ‚Ññ12. –ò–≥—Ä–æ–∫ –≤—ã–±—Ä–∞–ª –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ê, –ë –∏ –í¬ª.
*   **–ú–∞–ø–ø–∏–Ω–≥:**
    *   –ü–∞—Ä–∞–º–µ—Ç—Ä –ê -> –í–∫–ª—é—á–∞–µ—Ç –§–ª–∞–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `check_parry = True`).
    *   –ü–∞—Ä–∞–º–µ—Ç—Ä –ë -> –í–∫–ª—é—á–∞–µ—Ç –§–ª–∞–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ignore_armor = True`).
    *   –ü–∞—Ä–∞–º–µ—Ç—Ä –í -> –ó–∞—Ä—è–∂–∞–µ—Ç –¢—Ä–∏–≥–≥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TITAN_CRUSH` —Å —à–∞–Ω—Å–æ–º 15%).
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ä–µ–∫—Ç `PipelineFlagsDTO`, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–æ, —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ ¬´–∫–æ–º–Ω–∞—Ç—ã¬ª –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –ø—Ä–æ–π–¥–µ—Ç —ç—Ç–æ—Ç —Ä–∞–∑–º–µ–Ω.

### –°—Ç–∞–¥–∏—è 1: Pre-Calc (Ability Service - Pre)
–ó–¥–µ—Å—å ¬´–Ω–∞–≤–µ—à–∏–≤–∞–µ—Ç—Å—è¬ª –≤–Ω–µ—à–Ω—è—è –º–∞–≥–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏—Ä–∞.

*   **–î–µ–π—Å—Ç–≤–∏–µ:** –°–µ—Ä–≤–∏—Å –∞–±–∏–ª–æ–∫ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞—Ñ—Ñ—ã/–¥–µ–±–∞—Ñ—Ñ—ã.
*   **–í–ª–∏—è–Ω–∏–µ:** –ï—Å–ª–∏ –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ –≤–∏—Å–∏—Ç ¬´–û—Å–ª–µ–ø–ª–µ–Ω–∏–µ¬ª, —Å–µ—Ä–≤–∏—Å –∑–∞—Ö–æ–¥–∏—Ç –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –•–µ–ª–ø–µ—Ä–æ–º `PipelineFlagsDTO` –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç —Ñ–ª–∞–≥ `force_miss = True`.
*   **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–º–µ—Ä—Ç–∏:** –ï—Å–ª–∏ –•–µ–ª–ø–µ—Ä –∏–ª–∏ –ê–±–∏–ª–∏—Ç–∏-—Å–µ—Ä–≤–∏—Å –≤–∏–¥—è—Ç, —á—Ç–æ —Ü–µ–ª—å –º–µ—Ä—Ç–≤–∞ (–∏ —ç—Ç–æ –Ω–µ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ) ‚Äî –æ–Ω–∏ —Å—Ç–∞–≤—è—Ç `run_calculator = False`.

### –°—Ç–∞–¥–∏—è 2: Combat Calculator (Execution)
–ß–∏—Å—Ç—ã–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ç–µ–º, —á—Ç–æ –µ–º—É —Ä–∞–∑—Ä–µ—à–∏–ª–∏.

*   **–ò–µ—Ä–∞—Ä—Ö–∏—è —Ñ—É–Ω–∫—Ü–∏–π:** –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏–¥–µ—Ç –ø–æ —Å–ø–∏—Å–∫—É: Accuracy -> Evasion -> Parry -> Block -> Damage.
*   **–†–∞–±–æ—Ç–∞ —Å —Ñ–ª–∞–≥–∞–º–∏:** –í –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –æ–Ω –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥: `if not flags.check_dodge: return SUCCESS`.
*   **–†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏:** –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞, –æ–Ω –±—Ä–æ—Å–∞–µ—Ç –∫—É–±–∏–∫ –Ω–∞ —Ç—Ä–∏–≥–≥–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –•–µ–ª–ø–µ—Ä –∑–∞–ª–æ–∂–∏–ª –Ω–∞ –°—Ç–∞–¥–∏–∏ 0. –ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª ‚Äî –æ–Ω –º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—É –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—á–∏—Ç–∞–µ—Ç —É—Ä–æ–Ω –±–µ–∑ —É—á–µ—Ç–∞ Flat Armor).

### –°—Ç–∞–¥–∏—è 3: Post-Calc (Ability Service - Post)
–°—Ç–∞–¥–∏—è ¬´—Ä–µ–∞–∫—Ü–∏–∏¬ª. –ó–¥–µ—Å—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–æ —Ñ–∞–∫—Ç—É.

*   **–í—Ö–æ–¥:** –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (–•–∏—Ç, –ë–ª–æ–∫, –ö—Ä–∏—Ç, –∏—Ç–æ–≥–æ–≤—ã–π —É—Ä–æ–Ω).
*   **–õ–æ–≥–∏–∫–∞:** –°–µ—Ä–≤–∏—Å –∞–±–∏–ª–æ–∫ –≤–∏–¥–∏—Ç: ¬´–ë—ã–ª –•–∏—Ç¬ª. –û–Ω –ª–µ–∑–µ—Ç –≤ —Å—Ç–∞—Ç—ã –∞—Ç–∫–µ—Ä–∞, –≤–∏–¥–∏—Ç —Ç–∞–º ¬´–í–∞–º–ø–∏—Ä–∏–∑–º¬ª –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–µ—á–µ–Ω–∏—è.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ª–µ—á–µ–Ω–∏–∏, —à–∏–ø–∞—Ö –∏–ª–∏ –∫–æ–Ω—Ç—Ä—É–¥–∞—Ä–∞—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è `InteractionResultDTO`.

### –°—Ç–∞–¥–∏—è 4: Mechanics (Final Commit)
–¢–æ—á–∫–∞ –∑–∞–ø–∏—Å–∏.

*   **–î–µ–π—Å—Ç–≤–∏–µ:** –ë–µ—Ä–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –ø–∞–∫–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏ `MechanicsFlagsDTO`.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å—ã–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é, –º–µ–Ω—è–µ—Ç HP –≤ Redis (In-Memory Snapshot), –Ω–∞—á–∏—Å–ª—è–µ—Ç –æ–ø—ã—Ç. –ï—Å–ª–∏ —Ñ–ª–∞–≥ `check_death` –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ ¬´–ú–µ—Ä—Ç–≤¬ª.