# Pipeline Orchestrator Specification (RBC v3.1)

**Role:** Logic Core.
**Responsibility:** –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –±–æ–µ–≤–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `PipelineContextDTO`.

---

## üìë –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–∞–π–ø–ª–∞–π–Ω–∞ (Phased Execution)

–ü–∞–π–ø–ª–∞–π–Ω –±–æ–ª—å—à–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∂–µ—Å—Ç–∫–æ–π —Ç—Ä—É–±–æ–π. –≠—Ç–æ –Ω–∞–±–æ—Ä –º–æ–¥—É–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ —É—Å–ª–æ–≤–∏—é.

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
*   `ActorDTO` (–ê—Ç–∞–∫—É—é—â–∏–π)
*   `TargetDTO` (–ó–∞—â–∏—Ç–Ω–∏–∫)
*   `PipelineContextDTO` (–°–æ–±—Ä–∞–Ω–Ω—ã–π –ë–∏–ª–¥–µ—Ä–æ–º –ø—É–ª—å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### –§–∞–∑–∞ 1: Pre-Calculation (Ability Service)
*   **Condition:** `if context.phases["run_pre_calc"]`
*   **Logic:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ë–µ—Ä—Å–µ—Ä–∫" –ø–µ—Ä–µ–¥ —É–¥–∞—Ä–æ–º).
*   **Output:** –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–ª–∞–≥–∏ –≤ `context` –ø–µ—Ä–µ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º.

### –§–∞–∑–∞ 2: Combat Calculator (Math Core)
*   **Condition:** `if context.phases["run_calculator"]`
*   **Logic:**
    *   Accuracy -> Evasion -> Parry -> Block -> Damage.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `context.formulas` –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤.
*   **Output:** `CalculationResultDTO` (–£—Ä–æ–Ω, –ö—Ä–∏—Ç, –ü—Ä–æ–º–∞—Ö).
*   **Fallback:** –ï—Å–ª–∏ —Ñ–∞–∑–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ (–∏–∑-–∑–∞ –°—Ç–∞–Ω–∞), —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–£—Ä–æ–Ω=0, Miss=True).

### –§–∞–∑–∞ 3: Post-Calculation (Ability Service)
*   **Condition:** `if context.phases["run_post_calc"]`
*   **Logic:**
    *   –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (Bleed, Poison) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏.
    *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ (Cooldowns, Duration).
*   **–í–∞–∂–Ω–æ:** –≠—Ç–∞ —Ñ–∞–∑–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –∞—Ç–∞–∫–∏ –Ω–µ –±—ã–ª–æ (—á—Ç–æ–±—ã —Å–Ω—è—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –±–∞—Ñ—Ñ—ã).

### –§–∞–∑–∞ 4: Mechanics (Commit)
*   **Logic:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ —Å—Ç–µ–π—Ç—É (HP, Tokens).
*   **Output:** `InteractionResult` –¥–ª—è –ª–æ–≥–æ–≤ –∏ –∫–ª–∏–µ–Ω—Ç–∞.
