# Weapon Mastery Specification (RBC v3.1)

## 1. Система навыков владения (Mastery)
Навык — это значение от 0.0 до 100.0, которое выступает основным модификатором для расчетов.

В игре выделяется 5 базовых классов владения оружием:
1.  **Swords (Клинковое):** Мечи, палаши, бастард-мечи.
2.  **Fencing (Колющее/Фехтовальное):** Кинжалы, рапиры, стилеты, шпаги.
3.  **Polearms (Древковое):** Пики, алебарды, копья.
4.  **Macing (Дробящее):** Булавы, молоты.
5.  **Archery (Дальнобойное):** Луки, арбалеты.

### Функции навыка:
*   **Снижение штрафа на точность:** Оружие имеет базовый штраф, который нивелируется прокачкой.
*   **Увеличение Шанса Крита (Item Trigger):**
    *   Крит больше не является просто "x2 уроном".
    *   Крит — это срабатывание **встроенной способности оружия** (Item Trigger).
    *   Эффект зависит от предмета: это может быть x2 урон, Стан, Кровотечение, Пробитие брони и т.д.
    *   Навык повышает вероятность этого события. Базовый шанс зашит в качество оружия.
*   **Стабильность (Сжатие разброса):** Навык не увеличивает базовый урон, а подтягивает «нижний порог» урона к максимуму.

---

## 2. Формула урона и стабильности
Система отказывается от классического Min-Max урона в пользу **Базового урона (Max)** и **Процента разброса**.

*   **BaseDamage:** Итоговый максимальный урон (из модификаторов игрока).
*   **BaseSpread:** Процент разброса (задается классом или типом оружия).
*   **Мастерство:** Срезает текущий разброс (например, в 2 раза на 100% навыка).

### Логика расчета:
Если `BaseDamage = 100`, а `Spread = 40%`, то диапазон новичка — **60–100**.
Мастер (снизив разброс до 20%) получает диапазон **80–100**.

> **Принцип:** Урон становится стабильнее, но не превышает потолок итогового урона.

---

## 3. Тактические токены и Финты (Абилки)

### Механика Токенов
Токены — это жесткие флаги, генерируемые калькулятором по результату действия:
*   **Награда за успех:** Ударил/Попал/Увернулся — получил соответствующий токен (Хит, Уворот, Контрудар).
*   **Награда врагу:** Промахнулся — дал противнику Токен Темпа.
*   **Ограничение:** Не более 1–2 токенов за один размен.
*   **Расход:** Токены тратятся на активацию финтов или мгновенные реакции (отхил, смена цели, прерывание).

### Пул Финтов
Игрок формирует пул из 15–20 приемов, который собирается из:
1.  **База навыка (4 финта):** Привязаны к зонам (Голова, Грудь, Руки, Ноги). Эффекты (смена состояния) схожи внутри класса.
2.  **Предмет (2–5 финтов):** Зависят от конкретного типа (например, у Фламберга и Бастарда будут разные наборы).
3.  **Режим (Стойка):** Дополнительные финты от щита, двуручного хвата или боя в две руки.

**Интерфейс выбора:** Система предлагает 2 случайных финта из пула. Игрок выбирает: ударить «Просто» или реализовать один из выпавших шансов за токены.

---

## 4. Структура данных оружия (Обязательные поля)
Для создания индивидуальности каждого предмета, объект оружия должен содержать следующие поля:

*   **WeaponClass:** Ссылка на один из 5 навыков владения.
*   **ClassTriggerName:** Название триггера (например, «Контроль» для мечей).
*   **BaseAccuracy:** Базовая точность предмета.
*   **ItemTriggerName:** Уникальный триггер типа оружия (например, «Кровотечение»).
*   **ItemTriggerChance:** Базовый статичный шанс (зависит от качества, а не от навыка).
*   **BaseDamage:** Максимальный урон (Физика по умолчанию).
*   **BaseSpread:** Базовый процент разброса для этого предмета.

---

## 5. Броня и Навык защиты
*   **Отказ от АС (Armor Class):** Точность и уворот проверяются через навыки, броня не влияет на шанс попадания в стиле D&D.
*   **Flat Reduction (Вычет):** Броня всех частей тела суммируется и усредняется. Результат — фиксированное число, которое вычитается из входящего урона.
*   **Навык Брони:** Работает аналогично оружейному — снижает штрафы (на ловкость/скорость), накладываемые экипировкой.