# Inventory Module

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **Redis Session** –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î.

**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** Inventory –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î –Ω–∞–ø—Ä—è–º—É—é ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Redis, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–∏ (dirty flags).

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–æ–¥—É–ª—å

- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–≥—Ä–æ–∫–∞
- ‚úÖ –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ (–∑–µ–ª—å—è, —Å–≤–∏—Ç–∫–∏)
- ‚úÖ –°—Ç–∞–∫–∏–Ω–≥ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ã—Å—Ç—Ä—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–∞ –∏ –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç –º–æ–¥—É–ª—å

- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (—ç—Ç–æ Items –º–æ–¥—É–ª—å)
- ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª—É—Ç–∞ (—ç—Ç–æ LootService)
- ‚ùå –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î (—á–µ—Ä–µ–∑ Redis Session)
- ‚ùå –ö—Ä–∞—Ñ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
apps/game_core/modules/inventory/
‚îú‚îÄ‚îÄ inventory_core_orchestrator.py    # Entry point –¥–ª—è API
‚îú‚îÄ‚îÄ inventory_gateway.py              # –ü—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îî‚îÄ‚îÄ inventory/
    ‚îî‚îÄ‚îÄ logic/
        ‚îú‚îÄ‚îÄ inventory_session_manager.py   # –†–∞–±–æ—Ç–∞ —Å Redis Session
        ‚îú‚îÄ‚îÄ inventory_logic.py             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        ‚îî‚îÄ‚îÄ inventory_formatter.py         # UI —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                  | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å                           |
|----------------------------|-------------------------------------------|
| InventoryCoreOrchestrator  | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (get_entry_point)            |
| InventoryGateway           | –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è router               |
| InventorySessionManager    | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Redis Session                  |
| InventoryLogic             | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (equip, use, stack)        |
| InventoryFormatter         | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞            |

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

1. **[–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è](./architecture.md)**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
   - –§–ª–æ—É —Ä–∞–±–æ—Ç—ã (view, equip, use)
   - –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

2. **[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏](./session_management.md)**
   - Redis Session lifecycle
   - Dirty flags –º–µ—Ö–∞–Ω–∏–∑–º
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î
   - TTL –∏ –æ—á–∏—Å—Ç–∫–∞

3. **[Gateway API](./gateway.md)**
   - –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã
   - –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

4. **[–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö](./formatting_and_ui.md)**
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
   - Tooltip –¥–∞–Ω–Ω—ã–µ

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–µ —Ñ–ª–æ—É

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

```
User ‚Üí API ‚Üí InventoryCoreOrchestrator
  ‚Üì
InventoryGateway.view_inventory(char_id)
  ‚Üì
InventoryLogic –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç snapshot —á–µ—Ä–µ–∑ router
  ‚Üì
ContextAssembler –≥–æ—Ç–æ–≤–∏—Ç temp:inventory:{uuid}
  ‚Üì
SessionManager –∫–æ–ø–∏—Ä—É–µ—Ç –≤ session:inventory:{char_id}
  ‚Üì
Formatter –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç UI –¥–∞–Ω–Ω—ã–µ
  ‚Üì
–í–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç—É
```

### 2. –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞

```
User ‚Üí API ‚Üí InventoryCoreOrchestrator
  ‚Üì
InventoryGateway.equip_item(char_id, item_id)
  ‚Üì
SessionManager.get_session_data()
  ‚Üì
InventoryLogic.equip_item_logic()
  ‚Üì
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Redis Session
  ‚Üì
SessionManager.mark_dirty()
  ‚Üì
–í–æ–∑–≤—Ä–∞—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### 3. –í—ã—Ö–æ–¥ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

```
User –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
  ‚Üì
SessionManager.sync_to_db(char_id)
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ dirty flag
  ‚Üì
–ï—Å–ª–∏ dirty=True ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
  ‚Üì
–û—á–∏—Å—Ç–∫–∞ Redis Session
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. Redis-First –ø–æ–¥—Ö–æ–¥
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Redis. –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

### 2. Dirty Flags
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–º–æ—Ç—Ä–µ–ª ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–µ—á–µ–≥–æ.

### 3. Snapshot –æ—Ç ContextAssembler
Inventory –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –Ω–∞–ø—Ä—è–º—É—é ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π snapshot —á–µ—Ä–µ–∑ router.

### 4. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Items
Inventory —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DTO –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –Ω–µ –∑–Ω–∞—è –∫–∞–∫ –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è.

### 5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (Formatter).

---

## üîß –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
- **Items** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (—á–µ—Ä–µ–∑ router)
- **ContextAssembler** ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ snapshots
- **CoreRouter** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **Redis** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
- **PostgreSQL** ‚Äî –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ Repository)

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- **IInventoryRepo** ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (–≤ `common/database/db_contract/`)

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Redis Session
```python
session:inventory:{char_id} = {
    "metadata": {
        "char_id": 1,
        "loaded_at": 1704067200,
        "dirty": False
    },
    "equipped": {
        "main_hand": {...},
        "off_hand": {...},
        "armor": {...}
    },
    "backpack": [
        {...},  # InventoryItemDTO
        {...}
    ],
    "quick_slots": [
        {...},  # Consumable
        {...}
    ]
}
```

### Temp Snapshot
```python
temp:inventory:{uuid} = {
    "items": [
        # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ –ë–î
    ],
    "display_data": {
        # –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è UI
    }
}
```

---

## üöÄ Roadmap

### Phase 1: MVP (—Ç–µ–∫—É—â–∞—è)
- [ ] InventorySessionManager
- [ ] –ë–∞–∑–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ Redis
- [ ] Dirty flags

### Phase 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –°—Ç–∞–∫–∏–Ω–≥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
- [ ] –ë—ã—Å—Ç—Ä—ã–µ —Å–ª–æ—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–∞/–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### Phase 3: UI –∏ UX
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–æ —Ç–∏–ø—É, —Ä–µ–¥–∫–æ—Å—Ç–∏, —Ü–µ–Ω–µ)
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- [ ] –ü–æ–∏—Å–∫
- [ ] –î–µ—Ç–∞–ª—å–Ω—ã–µ tooltip'—ã

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Items Module:** [../items/README.md](../items/README.md)
- **ContextAssembler:** `/docs/architecture/game_core_services/context_assembler_v2/`
- **CoreRouter:** `/docs/architecture/game_core_services/core_router/`
- **Redis Sessions:** `/docs/architecture/redis_sessions/`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –Ø–Ω–≤–∞—Ä—å 2026  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ñ–∞–∑–∞)
