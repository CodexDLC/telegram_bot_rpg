# Items & Inventory System

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –¥–ª—è Telegram RPG. –°–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –º–æ–¥—É–ª–µ–π:

- **Items** ‚Äî –º–µ–∂–¥–æ–º–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
- **Inventory** ‚Äî –∏–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

```
apps/game_core/modules/
‚îú‚îÄ‚îÄ inventory/              # –ò–≥—Ä–æ–≤–æ–π —Å—Ç–µ–π—Ç (—Å API)
‚îÇ   ‚îú‚îÄ‚îÄ inventory_core_orchestrator.py
‚îÇ   ‚îú‚îÄ‚îÄ inventory_gateway.py
‚îÇ   ‚îî‚îÄ‚îÄ inventory/
‚îÇ       ‚îî‚îÄ‚îÄ logic/
‚îÇ
‚îî‚îÄ‚îÄ _services/              # –ú–µ–∂–¥–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–±–µ–∑ API)
    ‚îî‚îÄ‚îÄ items/
        ‚îú‚îÄ‚îÄ items_core_orchestrator.py
        ‚îî‚îÄ‚îÄ logic/
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

| –ú–æ–¥—É–ª—å    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                              | API | –ë–î  | Redis |
|-----------|-----------------------------------------|-----|-----|-------|
| Items     | –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–ª—É—Ç, –∫—Ä–∞—Ñ—Ç, –Ω–∞–≥—Ä–∞–¥—ã)| ‚ùå  | ‚úÖ  | ‚ùå    |
| Inventory | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º –∏–≥—Ä–æ–∫–∞            | ‚úÖ  | ‚ùå* | ‚úÖ    |

*Inventory –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î –Ω–∞–ø—Ä—è–º—É—é ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis Session

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º

### Items Module

–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ `ItemAssembler`, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª—É—Ç–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (Game Design)](../../rpg_system/items/README.md)
2. [DTO —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](./items/item_dto_reference.md)
3. [–ö–æ–Ω–≤–µ–π–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤](./items/item_creation_pipeline.md)
4. [–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ DTO](./items/migration_to_dto.md)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ–µ–º](./items/combat_integration.md)
6. [–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (Game Design)](../../rpg_system/items/weapon_triggers.md)

### Inventory Module

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º —á–µ—Ä–µ–∑ Redis Session, —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤.

**–î–æ–∫—É–º–µ–Ω—Ç—ã:**
1. [–û–±–∑–æ—Ä –º–æ–¥—É–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è](./inventory/README.md)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./inventory/inventory_architecture.md)
3. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏](./inventory/session_management.md)
4. [Gateway API](./inventory/gateway.md)
5. [–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö](./inventory/formatting_and_ui.md)

---

## üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª—É—Ç–∞ –ø–æ—Å–ª–µ –±–æ—è

```
Combat ‚Üí Items (generate_loot)
  ‚Üì
ItemAssembler —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥–º–µ—Ç
  ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—É SYSTEM)
  ‚Üì
ItemDistributionService –ø–µ—Ä–µ–¥–∞—ë—Ç –∏–≥—Ä–æ–∫—É
  ‚Üì
Inventory –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞

```
User ‚Üí Inventory (equip_item)
  ‚Üì
InventoryLogic –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Redis Session
  ‚Üì
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ session:inventory:{char_id}
  ‚Üì
–§–ª–∞–≥ dirty=true
  ‚Üì
–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ ‚Üí sync_to_db()
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

```
User ‚Üí Inventory (view_inventory)
  ‚Üì
InventoryLogic –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç snapshot
  ‚Üì
router ‚Üí ContextAssembler (prepare_inventory)
  ‚Üì
ContextAssembler –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –ë–î
  ‚Üì
ItemAssembler.assemble_for_inventory_display()
  ‚Üì
–î–∞–Ω–Ω—ã–µ –≤ temp:inventory:{uuid}
  ‚Üì
InventorySessionManager –∫–æ–ø–∏—Ä—É–µ—Ç –≤ session
  ‚Üì
InventoryFormatter ‚Üí UI –¥–∞–Ω–Ω—ã–µ
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **Items** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ
- **Inventory** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 2. –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
- **Items** –ø–∏—à–µ—Ç –≤ –ë–î —á–µ—Ä–µ–∑ Repository
- **Inventory** —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Redis Session
- **ContextAssembler** –≥–æ—Ç–æ–≤–∏—Ç snapshots

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ Redis
- Dirty flags –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ `CoreRouter`
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (`get_entry_point`)
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏ (—Å–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                    |
|--------------------|-------------------------------|
| DTO                | Pydantic BaseModel            |
| –ë–î                 | PostgreSQL + SQLAlchemy       |
| –ö—ç—à                | Redis                         |
| –í–∞–ª–∏–¥–∞—Ü–∏—è          | Pydantic validators           |
| –†–æ—É—Ç–∏–Ω–≥            | CoreRouter                    |
| –°–µ—Å—Å–∏–∏             | Redis TTL                     |

---

## üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Items Module
- ‚úÖ DTO —Å—Ö–µ–º—ã (WeaponData, ArmorData, etc.)
- ‚úÖ ItemAssembler (–±–∞–∑–æ–≤—ã–π)
- ‚úÖ LootService (–±–∞–∑–æ–≤—ã–π)
- ‚è≥ ItemAssembler —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (power/spread –≤–º–µ—Å—Ç–æ damage_min/max)
- ‚è≥ –¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç –∞—Ñ—Ñ–∏–∫—Å–æ–≤
- ‚è≥ LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏–º—ë–Ω

### Inventory Module
- ‚è≥ InventoryGateway
- ‚è≥ InventorySessionManager
- ‚è≥ InventoryLogic
- ‚è≥ InventoryFormatter
- ‚è≥ Dirty flags –º–µ—Ö–∞–Ω–∏–∑–º
- ‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Redis ‚Üí –ë–î

---

## üöÄ Roadmap

### Phase 1: MVP
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ItemAssembler –ø–æ–¥ RBC v3.1
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è InventorySessionManager
3. –ë–∞–∑–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
4. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —á–µ—Ä–µ–∑ Redis

### Phase 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. –°—Ç–∞–∫–∏–Ω–≥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
3. –ë—ã—Å—Ç—Ä—ã–µ —Å–ª–æ—Ç—ã (quick slots)
4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### Phase 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏
1. LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º—ë–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤
2. –¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç –∞—Ñ—Ñ–∏–∫—Å–æ–≤ –≤ bonuses
3. –°–∏—Å—Ç–µ–º–∞ –∫—Ä–∞—Ñ—Ç–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å)
4. –¢–æ—Ä–≥–æ–≤–ª—è –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ë–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:** `../../combat_system_v3/README.md`
- **ContextAssembler:** `../../game_core_services/context_assembler_v2/README.md`
- **CoreRouter:** `../../game_core_services/core_router/README.md`
- **Redis Sessions:** `../../redis_sessions/README.md`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –Ø–Ω–≤–∞—Ä—å 2026  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (MVP)
