# Zone Resolution Specification (RBC v3.1)

## 1. Смена Парадигмы (Paradigm Shift)
В предыдущих версиях (v2.x) выбор зоны атаки и защиты был отдельным этапом ввода игрока ("Куда бьешь?", "Что блочишь?").
В версии **v3.1** эта механика полностью переработана.

**Новый принцип:**
> **Зона — это семантическое свойство Приема (Feint), а не выбор игрока.**

Игрок выбирает **Действие** (например, "Рассечение шлема"), а система сама знает, что это действие направлено в зону `HEAD`.

---

## 2. Определение Зон (Zone Definition)

### A. Explicit Zones (Явные зоны в Финтах)
Большинство спецприемов (Feints) имеют жестко прописанную целевую зону в своей конфигурации.

```python
# Config Example
"skull_crusher": {
    "display_name": "Череполом",
    "target_zone": ["HEAD"],  # Всегда бьет в голову
    "block_zones": ["HEAD", "BODY"] # Во время удара боец прикрывает эти зоны
}
```

### B. Implicit/Auto Zones (Неявные зоны)
Для базовых атак или универсальных приемов зона может определяться автоматически.

*   **Basic Attack:** Обычно направлена в `BODY` (самая большая зона).
*   **Smart Attacks:** (Для AI или спец-абилок) Могут выбирать зону с наименьшей защитой в момент резолва.

---

## 3. Механика Разрешения (Resolution Flow)

1.  **Intent Parsing:**
    *   Система получает Intent с ID приема (например, `skull_crusher`).
    *   Извлекает конфигурацию приема.
    *   Заполняет поле `attack_zones` в пейлоаде для калькулятора.

2.  **Calculator Processing:**
    *   Калькулятор получает списки `attack_zones` (от Атакующего) и `block_zones` (от Защищающегося).
    *   Проверяет пересечение множеств.
    *   Если пересечение есть -> Удар заблокирован (срабатывает Mitigation).
    *   Если пересечения нет -> Удар проходит (проверка Evasion/Armor).

---

## 4. Анатомия (Target Anatomy)
Система поддерживает разные типы тел (Humanoid, Beast, etc.), описанные в `Feints Library`.
Если финт бьет в `LEGS`, а у цели нет ног (например, `Serpentine`), финт может быть либо недоступен для выбора, либо автоматически перенаправлен в `BODY` (Fallback).

## 5. Вывод
Эта система упрощает UX (меньше кликов) и добавляет тактическую глубину через выбор правильного приема под ситуацию, а не через угадайку "Камень-Ножницы-Бумага".
