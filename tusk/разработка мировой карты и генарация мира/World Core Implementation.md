# IMPLEMENTATION ROADMAP: WORLD CORE & LATENT SYSTEM

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –º–∏—Ä (105x105) —Å —Ä–∞—Å—á–µ—Ç–æ–º —É–≥—Ä–æ–∑, "—Å–ø—è—â–µ–π" —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ —Ä–∞–±–æ—á–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ "–∞–∫—Ç–∏–≤–Ω–æ–º—É –≥—Ä–∞—Ñ—É" –≤ Redis.

---

## üì¶ Phase 1: Database & Configuration (–§—É–Ω–¥–∞–º–µ–Ω—Ç)

_–°–æ–∑–¥–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏._

1. **[Config] –°–æ–∑–¥–∞—Ç—å `app/resources/game_data/world_config.py`**
    
    - [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–∞—Ä—Ç—ã (`105x105`).
        
    - [x] –ó–∞–¥–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã **–•–∞–±–∞** (`D4` / `52:52`).
        
    - [x] –ó–∞–¥–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã **4 –Ø–∫–æ—Ä–µ–π** (–ö—Ä–µ—Å—Ç: `A4`, `G4`, `D1`, `D7`).
        
    - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–µ–π (`Power`, `Falloff`) –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã —É–≥—Ä–æ–∑—ã.
        
    - [x] –°–æ–∑–¥–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å `STATIC_LOCATIONS` (—Ä—É—á–Ω–æ–π —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫ –•–∞–±–∞ –∏ –°–µ—Ä–≤–∏—Å–æ–≤).
        
2. **[SQL] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ `database/model_orm/world.py`**
    
    - [x] **`WorldSector`**: –¢–∞–±–ª–∏—Ü–∞-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (id, tier, biome).
        
    - [x] **`WorldGrid`**: –û—Å–Ω–æ–≤–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞.
        
        - `is_active`: Boolean (–ì–ª–∞–≤–Ω—ã–π —Ç—É–º–±–ª–µ—Ä).
            
        - `service_object_key`: String (–í—Ö–æ–¥ –≤ —Å–µ—Ä–≤–∏—Å—ã).
            
        - `flags`: JSONB (–•—Ä–∞–Ω–∏—Ç `threat_level`, `latent_rift_id`, `has_road`).
            
    - [x] **–ò–Ω–¥–µ–∫—Å—ã**: –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`x`, `y`, `is_active`).
        
3. **[Repo] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `database/repositories/ORM/world_repo.py`**
    
    - [x] `upsert_node`: –ú–µ—Ç–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–¥–ª—è –°–∏–¥–µ—Ä–∞).
        
    - [x] `get_sector_by_coords`: –•–µ–ª–ø–µ—Ä –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–µ–∫—Ç–æ—Ä–∞.
        

---

## üßÆ Phase 2: Logic & Seeding (–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ú–∞—Ç—Ä–∏—Ü—ã)

_–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 11,025 –∫–ª–µ—Ç–æ–∫, —Å—á–∏—Ç–∞–µ–º –º–∞—Ç–µ–º–∞—Ç–∏–∫—É, –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å._

4. **[Math] –°–æ–∑–¥–∞—Ç—å `app/services/game_service/world/threat_service.py`**
    
    - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `calculate_threat(x, y)` –ø–æ —Ñ–æ—Ä–º—É–ª–µ: `(Œ£ Anchors) - Portal`.
        
    - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥ `get_tier(threat_float) -> int` (0..7).
        
    - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_simple_path(start, end)` (–¥–ª—è –ø—Ä–æ–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –¥–æ—Ä–æ–≥ –Ω–∞ —ç—Ç–∞–ø–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏).
        
5. **[Script] –°–æ–∑–¥–∞—Ç—å `scripts/seed_world_gen.py`**
    
    - [x] **–¶–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** –ü—Ä–æ—Ö–æ–¥ –ø–æ —Å–µ—Ç–∫–µ 0..104.
        
    - [x] **–†–∞—Å—á–µ—Ç—ã:** –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –£–≥—Ä–æ–∑—ã –∏ –¢–∏—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–∏.
        
    - [x] **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ó–∞–ø–∏—Å—å –≤–æ `flags` –∑–∞–≥–æ—Ç–æ–≤–æ–∫ (`latent_rift_id`) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¢–∏—Ä–∞.
        
    - [x] **–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
        
        - –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –≤ `STATIC_LOCATIONS` -> `is_active=True`, `content` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞.
            
        - –ï—Å–ª–∏ –ª–µ–∂–∏—Ç –Ω–∞ –ª–∏–Ω–∏–∏ –¥–æ—Ä–æ–≥–∏ (Path) -> `is_active=True`, `has_road=True`.
            
        - –ò–Ω–∞—á–µ -> `is_active=False`.
            

---

## üîå Phase 3: Runtime System (Redis Loader)

_–£—á–∏–º —Å–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∂–∞—Ç—å "–°–≤–µ—Ç–ª—É—é –∑–æ–Ω—É" –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å._

6. **[Redis] –û–±–Ω–æ–≤–∏—Ç—å `app/services/core_service/manager/world_manager.py`**
    
    - [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ `Hash` (`meta`, `view`, `exits`).
        
    - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Strict-getter: –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç ‚Äî –≤–µ—Ä–Ω—É—Ç—å `None` (–Ω–µ —Ö–æ–¥–∏—Ç—å –≤ SQL).
        
7. **[Logic] –°–æ–∑–¥–∞—Ç—å `app/services/game_service/world/world_loader_service.py`**
    
    - [x] –ú–µ—Ç–æ–¥ `init_world_cache()`:
        
        1. –í—ã–≥—Ä—É–∂–∞–µ—Ç –∏–∑ SQL –≤—Å–µ –∫–ª–µ—Ç–∫–∏ —Å `is_active=True`.
            
        2. –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Å–µ–¥–µ–π (–ø—Ä–æ–≤–µ—Ä—è—è –∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å).
            
        3. –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON –∫–Ω–æ–ø–æ–∫ (`nav` –∏ `svc`).
            
        4. –ó–∞–ª–∏–≤–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω–æ–º –≤ Redis.
            

---

## üé® Phase 4: UI & Scanner (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

_–¢–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –∏–≥—Ä–æ–∫._

8. **[UI] –û–±–Ω–æ–≤–∏—Ç—å `app/services/ui_service/navigation_service.py`**
    
    - [ ] **Scanner Widget:** –î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –±–ª–æ–∫ "–°–∫–∞–Ω–µ—Ä –°–∏–º–±–∏–æ—Ç–∞":
        
        - –ß—Ç–µ–Ω–∏–µ `threat_level` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö -> –¢–µ–∫—Å—Ç–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å ("–§–æ–Ω —Å—Ç–∞–±–∏–ª–µ–Ω" / "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É–≥—Ä–æ–∑–∞").
            
        - –ß—Ç–µ–Ω–∏–µ –∫–ª—é—á–µ–π `combat:*` –≤ –ª–æ–∫–∞—Ü–∏–∏ -> –°—Ç–∞—Ç—É—Å "–ò–¥–µ—Ç –±–æ–π".
            
    - [ ] **JRPG Stub:** –í –º–µ—Ç–æ–¥ `move_player` –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —ç–Ω–∫–∞—É–Ω—Ç–µ—Ä (–ø–æ–∫–∞ –±–µ–∑ —Å–∞–º–æ–≥–æ –±–æ—è, –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—á–µ—Ç —à–∞–Ω—Å–∞).