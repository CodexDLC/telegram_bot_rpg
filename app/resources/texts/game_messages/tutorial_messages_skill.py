# --- app/resources/game_data/tutorial_skill_events.py ---
#
# Этот файл содержит ЕДИНЫЙ словарь, описывающий все
# этапы и выборы в "Фазе Скиллов" туториала.
#
# СТРУКТУРА ОБНОВЛЕНА (v4 - по фидбэку):
# - step_2 содержит кнопки, которые ВЕДУТ к step_3
#   (e.g., "step_3:reflexes").
# - Внутри каждой ветки (path_melee) добавлен блок "step_3".
# - "step_3" содержит ключи, совпадающие с выбором
#   (e.g., "reflexes", "fire_magic").
# - Внутри каждого такого ключа лежат ДВА ключа:
#   1. "combat_log": [СПИСОК СТРОК] для лога боя.
#   2. "buttons": {СЛОВАРЬ С ОДНОЙ КНОПКОЙ} для перехода к финалу.
#
# (v4.1 - ТЕКСТ ПЕРЕПИСАН НА БОЛЕЕ АТМОСФЕРНЫЙ)
#

TUTORIAL_SKILL_EVENTS = {

    # --- 1. ФАЗА СКИЛЛОВ (Начало) ---
    "start_skill_phase": {
        "text": """[СИСТЕМА]: ...Процесс сканирования нейросигнатур завершен. 
Твои первичные параметры указывают на архетип: "Воин" [текст зависит от статов]. 
Инициализация симуляции... Ты открываешь глаза. Холодный камень. 
Впереди, на тускло освещенных постаментах, лежат три образца оружия. 
Система ожидает твоего выбора."""
        ,
        "buttons": {
            # (Логика: "step_1:path_melee" ->
            #  ищем 'path_melee', в нем 'step_1')
            "step_1:path_melee": "[Взять Ржавый Меч]",
            "step_1:path_ranged": "[Взять Короткий Лук]",
            "step_1:path_magic": "[Взять Потрескавшийся Посох]"
        }
    },

    # --- ВЕТКА MELEE ---
    "path_melee": {
        "step_1": {  # Выбор Брони
            "text": """[СИСТЕМА]: Ты берешь меч. Холодная сталь ложится в руку, 
на удивление знакомо. Впереди в зале открываются три ниши. 
На стойках висят комплекты брони, ожидая своего владельца. 
Симуляция предлагает тебе определить свою защиту."""
            ,
            "buttons": {
                # (Логика: "step_2:light_armor" ->
                #  ищем 'path_melee', в нем 'step_2',
                #  в нем 'light_armor')
                "step_2:light_armor": "[Кожаный Доспех]",
                "step_2:medium_armor": "[Кольчуга]",
                "step_2:heavy_armor": "[Латный Доспех]"
            },
        },
        "step_2": {  # Выбор Тактики
            "light_armor": {
                "text": """[СИСТЕМА]: Кожаный доспех сидит как влитой, 
не сковывая движений. Ты чувствуешь себя легким и проворным. 
Враг, которого симулирует система, — быстрая и ловкая Химера-Гарпия. 
Она будет полагаться на скорость. Как ты ответишь?"""
                ,
                "buttons": {
                    # (Логика: "step_3:reflexes" ->
                    #  ищем 'path_melee', в нем 'step_3',
                    #  в нем 'reflexes')
                    "step_3:reflexes": "[Положиться на Рефлексы]",
                    "step_3:intuition": "[Положиться на Интуицию]",
                    "step_3:arcane_magic": "[Усилить Клинок]"
                }
            },
            "medium_armor": {
                "text": """[СИСТЕМА]: Звенья кольчуги приятно холодят кожу. 
Она тяжелее, чем кожа, но обеспечивает надежный компромисс 
между защитой и мобильностью. Твой симулируемый противник — Химера-Волк. 
Сбалансированный и свирепый хищник. Какую тактику ты изберешь?"""
                ,
                "buttons": {
                    "step_3:reflexes": "[Использовать Уклонение]",
                    "step_3:intuition": "[Использовать Точность]",
                    "step_3:shield": "[Использовать Щит]"
                }
            },
            "heavy_armor": {
                "text": """[СИСТЕМА]: Ты с трудом затягиваешь последний ремень латного доспеха. 
Ты — ходячая крепость. Движения медленны, но каждый шаг отдает мощью. 
Против тебя — Химера-Медведь, настоящий джаггернаут из клыков и ярости. 
Твоя стратегия?"""
                ,
                "buttons": {
                    "step_3:shield": "[Принять удар на Щит]",
                    "step_3:fortitude": "[Принять удар на Броню]",
                    "step_3:persistence": "[Атаковать напролом]"
                }
            }
        },
        "step_3": {  # Сцены Боя (Лог + 1 кнопка)
            "reflexes": {
                "combat_log": [
                    ("[БОЙ]: Химера срывается с места, молниеносно сокращая дистанцию!", 2.5),
                    ("[БОЙ]: Ты полагаешься на свои РЕФЛЕКСЫ. В последний момент ты делаешь резкий рывок в сторону, пропуская удар мимо себя.",
                     2.5),
                    ("[БОЙ]: Враг открыт! Ты наносишь точный контрудар в незащищенный бок. ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "intuition": {
                "combat_log": [
                    ("[БОЙ]: Хищник напрягся, готовясь к прыжку.", 2.5),
                    ("[БОЙ]: Твоя ИНТУИЦИЯ кричит об опасности. Ты видишь, как напряглись мышцы на левой лапе врага.",
                     2.5),
                    ("[БОЙ]: Ты бьешь на опережение, вонзая клинок в уязвимую точку еще до того, как Химера успела атаковать! ПОБЕДА!",
                     2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "arcane_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера атакует, ее когти вспарывают воздух!", 2.5),
                    ("[БОЙ]: Ты УСИЛИВАЕШЬ КЛИНОК магией. Лезвие вспыхивает синим пламенем.", 2.5),
                    ("[БОЙ]: Твой удар встречается с ее атакой и разрубает врага надвое! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "shield": {
                "combat_log": [
                    ("[БОЙ]: Мощный удар Химеры-Джаггернаута обрушивается на тебя!", 2.5),
                    ("[БОЙ]: Ты крепко стоишь на ногах и принимаешь удар на ЩИТ. Раздается оглушительный грохот.", 2.5),
                    ("[БОЙ]: Враг на мгновение теряет равновесие от собственной силы. Ответный удар! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "fortitude": {
                "combat_log": [
                    ("[БОЙ]: Удар Химеры сотрясает тебя до костей!", 2.5),
                    ("[БОЙ]: Твоя СТОЙКОСТЬ и толстая броня выдерживают. Ты едва пошатнулся.", 2.5),
                    ("[БОЙ]: Ты игнорируешь боль и пробиваешься сквозь ее защиту! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "persistence": {
                "combat_log": [
                    ("[БОЙ]: Химера атакует, ты атакуешь в ответ. Вы обмениваетесь ударами.", 2.5),
                    ("[БОЙ]: Враг рычит от боли, но и ты чувствуешь, как трещит броня. Твоя НАСТОЙЧИВОСТЬ заставляет тебя идти вперед.",
                     2.5),
                    ("[БОЙ]: Ты сражаешь ее на чистой воле! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            }
        }
    },  # end melee branch

    # --- ВЕТКА RANGED ---
    "path_ranged": {
        "step_1": {  # Выбор Брони
            "text": """[СИСТЕМА]: Ты берешь лук. Дерево теплое, тетива тугая. 
Ты оказываешься в густом лесу. Воздух свежий. 
На стволе упавшего дерева лежат два комплекта брони."""
            ,
            "buttons": {
                "step_2:light_armor": "[Надеть Кожаный Доспех (Скорость)]",
                "step_2:medium_armor": "[Надеть Кольчугу (Баланс)]"
            }
        },
        "step_2": {  # Выбор Тактики
            "light_armor": {
                "text": """[СИСТЕМА]: Кожаный доспех сидит как влитой. 
Ты бесшумно ступаешь по мху. Внезапно, с небес раздается крик. 
Химера крылатая, похожая на грифона, пикирует с небес! Твоя тактика?"""
                ,
                "buttons": {
                    "step_3:reflexes": "[Уклониться в прыжке]",
                    "step_3:intuition": "[Выстрелить в уязвимое место]",
                    "step_3:air_magic": "[Создать Порыв Ветра]"
                }
            },
            "medium_armor": {
                "text": """[СИСТЕМА]: Кольчуга приятно утяжеляет шаг, давая чувство уверенности. 
Раздается треск веток. Из чащи, ломая кусты, 
несется Химера-кабан с огромными клыками! Твоя тактика?"""
                ,
                "buttons": {
                    "step_3:reflexes": "[Отскочить в сторону]",
                    "step_3:intuition": "[Выстрелить в глаз]",
                    "step_3:fortitude": "[Принять удар (Стойкость)]"
                }
            }
        },
        "step_3": { # Сцены Боя (Лог + 1 кнопка)
            "reflexes": {
                "combat_log": [
                    ("[БОЙ]: Химера пикирует / несется на тебя! Земля дрожит!", 2.5),
                    ("[БОЙ]: Ты используешь РЕФЛЕКСЫ, отпрыгивая в сторону в последний момент.", 2.5),
                    ("[БОЙ]: Враг проносится мимо. В развороте ты делаешь точный выстрел! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "intuition": {
                "combat_log": [
                    ("[БОЙ]: Химера несется прямо на тебя!", 2.5),
                    ("[БОЙ]: Твоя ИНТУИЦИЯ находит идеальный момент... Ты натягиваешь тетиву, время замедляется.", 2.5),
                    ("[БОЙ]: Выстрел! Стрела попадает точно в глаз / под крыло! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "air_magic": {
                "combat_log": [
                    ("[БОЙ]: Крылатая Химера пикирует с небес, готовя когти!", 2.5),
                    ("[БОЙ]: Ты инстинктивно взываешь к магии и создаешь ПОТРЫВ ВЕТРА, сбивая ее с курса.", 2.5),
                    ("[БОЙ]: Пока она дезориентирована, ты делаешь прицельный выстрел! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            },
            "fortitude": {
                "combat_log": [
                    ("[БОЙ]: Химера-кабан врезается в тебя! Удар такой силы, что ты летишь кубарем!", 2.5),
                    ("[БОЙ]: Твоя СТОЙКОСТЬ и кольчуга спасают тебя от переломов. Ты быстро вскакиваешь.", 2.5),
                    ("[БОЙ]: Химера разворачивается... но ты уже готов. Выстрел в упор! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_LOOTING": "[Собрать добычу]"}
            }
        }
    },  # end ranged branch

    # --- ВЕТКА MAGIC ---
    "path_magic": {
        "step_1": {
            "text": """[СИСТЕМА]: Как только твои пальцы касаются посоха, он теплеет, 
и по нему пробегает волна мягкой энергии. Окружение меняется. 
Ты в древней библиотеке, воздух пахнет пылью и озоном. 
Доспехи здесь — помеха. Перед тобой на пьедесталах лежат *два* источника силы: 
переливающийся Шар Стихий и темный, пульсирующий Кристалл Тайны (Arcane). 
Симуляция предлагает тебе выбрать свой Путь."""
            ,
            "buttons": {
                "step_2:elemental": "[Коснуться Шара Стихий]",
                "step_2:aspect": "[Коснуться Тайного Кристалла]"
            }
        },
        "step_2": {
            "elemental": {
                "text": """[СИСТЕМА]: Ты коснулся Шара Стихий. Он вспыхивает, 
наполняя тебя первобытной силой. В центре зала из вихря 
рычащего пламени и завывающего ветра формируется Химера-Элементаль. 
Она — воплощение хаоса. Какую стихию ты противопоставишь ей?"""
                ,
                "buttons": {
                    "step_3:fire_magic": "[Атаковать Огнем]",
                    "step_3:water_magic": "[Атаковать Водой]",
                    "step_3:earth_magic": "[Атаковать Землей]",
                    "step_3:air_magic": "[Атаковать Воздухом]"
                }
            },
            "aspect": {
                "text": """[СИСТЕМА]: Ты коснулся Тайного Кристалла. 
Он пульсирует холодом, и твой разум пронзают сложные формулы. 
Перед тобой из чистого света и живой тьмы сплетается Химера Аспекта. 
Она — воплощение парадокса. Какой аспект реальности ты выберешь?"""
                ,
                "buttons": {
                    "step_3:arcane_magic": "[Атаковать Тайной (Arcane) Магией]",
                    "step_3:light_magic": "[Атаковать Магией Света]",
                    "step_3:dark_magic": "[Атаковать Магией Тьмы]"
                }
            }
        },
        "step_3": { # Сцены Боя (Лог + 1 кнопка)
            "fire_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера Ветра и Пламени атакует, выпуская стену огня!", 2.5),
                    ("[БОЙ]: ОГОНЬ против ОГНЯ! Ты высвобождаешь свой собственный, более концентрированный поток.",
                     2.5),
                    ("[БОЙ]: Твоя магия чище и сильнее. Она поглощает пламя Химеры и ее саму! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "water_magic": {
                "combat_log": [
                    ("[БОЙ]: Огненная часть Химеры вспыхивает, готовясь испепелить тебя!", 2.5),
                    ("[БОЙ]: Ты инстинктивно призываешь силу ВОДЫ. Ледяной поток обрушивается на элементаля.", 2.5),
                    ("[БОЙ]: Раздается оглушительное шипение! Пар! Огонь гаснет, ветер стихает. Химера ослаблена и рассеивается! ПОБЕДА!",
                     2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "earth_magic": {
                "combat_log": [
                    ("[БОЙ]: Элементаль атакует тебя вихрем раскаленного воздуха!", 2.5),
                    ("[БОЙ]: Ты взываешь к силе ЗЕМЛИ. Каменная плита вырастает из-под пола, блокируя атаку.", 2.5),
                    ("[БОЙ]: Ты направляешь плиту вперед. Она врезается в нестабильную Химеру, рассеивая ее! ПОБЕДА!",
                     2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "air_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера-Элементаль собирает огненный шар, готовый к удару!", 2.5),
                    ("[БОЙ]: Ты отвечаешь чистой силой ВОЗДУХА. Сжатый порыв ветра сбивает заклинание нацело.", 2.5),
                    ("[БОЙ]: Не давая ей опомниться, ты создаешь вакуум вокруг нее, гася пламя! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "arcane_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера Света и Тьмы нестабильна, она пульсирует, искажая реальность.", 2.5),
                    ("[БОЙ]: Ты видишь ее суть. ТАЙНАЯ МАГИЯ (Arcane) — это сама структура. Ты тянешь за 'нити'.", 2.5),
                    ("[БОЙ]: Ты разрушаешь связь, державшую ее воедино! Химера коллапсирует в точку и исчезает! ПОБЕДА!",
                     2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "light_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера атакует тебя потоком чистой, удушающей Тьмы!", 2.5),
                    ("[БОЙ]: Твой СВЕТ вспыхивает, как маяк. Ты направляешь очищающий луч прямо в сердце тени.", 2.5),
                    ("[БОЙ]: Тьма отступает, не в силах вынести твое сияние. Свет очищает аномалию! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            },
            "dark_magic": {
                "combat_log": [
                    ("[БОЙ]: Химера атакует ослепляющим, болезненным Светом!", 2.5),
                    ("[БОЙ]: Ты призываешь ТЬМУ. Она не злая, она — покой. Тень накрывает тебя, поглощая атаку.", 2.5),
                    ("[БОЙ]: Свет Химеры гаснет в твоей всепоглощающей тени. Она рассеивается! ПОБЕДА!", 2.0)
                ],
                "buttons": {"finale:FINALE_MAGIC": "[Поглотить эссенцию]"}
            }
        }
    },  # end magic branch

    # --- 4. ФИНАЛЫ ---
    "finale": {
        "FINALE_LOOTING": {
            "text": """[СИСТЕМА]: ...Симуляция боя завершена. 
    Тело поверженной Химеры мерцает, готовое исчезнуть. 
    Система дает тебе мгновение на сбор трофеев. 
    Что ты инстинктивно решишь забрать?"""
            ,
            "buttons": {
                "p_end:mining": "[Выломать Руду и Кристаллы]",
                "p_end:skinning": "[Срезать Шкуру и Жилы]",
                "p_end:herbalism": "[Собрать Лечебные Травы]"
            }
        },

        "FINALE_MAGIC": {
            "text": """[СИСТЕМА]: ...Симуляция боя завершена. 
    Химера повержена и красиво растворяется в потоки чистой энергии, 
    которые летят к тебе, впитываясь в твою кожу. 
    Симуляция предлагает тебе сделать последний выбор: 
    какую эссенцию ты инстинктивно 'впитаешь' и сохранишь?"""
            ,
            "buttons": {
                "p_end:alchemy": "[Впитать Эссенцию Трансмутации (Алхимия)]",
                "p_end:science": "[Впитать Эссенцию Знания (Наука)]"
            }
        }
    }
}
